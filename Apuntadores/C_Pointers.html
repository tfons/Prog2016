<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>C/Pointers</title>
<link rel="stylesheet" type="text/css" media="all" charset="utf-8" href="C_Pointers_files/common.css">
<link rel="stylesheet" type="text/css" media="screen" charset="utf-8" href="C_Pointers_files/screen.css">
<link rel="stylesheet" type="text/css" media="print" charset="utf-8" href="C_Pointers_files/print.css">
<style type="text/css">
ul.pagetitle{
  display: inline;
  margin: 0;
  padding: 0;
  font-size: 1.5em;
}
li.pagetitle{
  display: inline;
  margin: 0;
}
td.noborder {
  border: 0;
}
</style>
</head>
<body>
<table>
<tbody><tr>
<td class="noborder">
<img src="C_Pointers_files/logo.png">
</td>
<td class="noborder">
<ul class="pagetitle">
<li class="pagetitle"><a class="backlink">C/Pointers</a>
</li></ul>
<br><br>
[<a href="http://www.cs.yale.edu/homes/aspnes/pinewiki/FrontPage.html">FrontPage</a>]&nbsp;[<a href="http://www.cs.yale.edu/homes/aspnes/pinewiki/TitleIndex.html">TitleIndex</a>]&nbsp;[<a href="http://www.cs.yale.edu/homes/aspnes/pinewiki/WordIndex.html">WordIndex</a>]&nbsp;
</td>
</tr>
</tbody></table>
<hr>
<div id="page"><p><b>Note:</b> You are looking at a static copy of the former PineWiki site, used for class notes by <a href="http://www.cs.yale.edu/homes/aspnes/">James Aspnes</a>
 from 2003 to 2012. Many mathematical formulas are broken, and there are
 likely to be other bugs as well. These will most likely not be fixed.  
You may be able to find more up-to-date versions of some of these notes 
at <a href="http://www.cs.yale.edu/homes/aspnes/#classes">http://www.cs.yale.edu/homes/aspnes/#classes</a>.</p>
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867"></p><div class="table-of-contents"><p class="table-of-contents-heading">Contents</p><ol><li>
<a href="#Memory_and_addresses">Memory and addresses</a></li><li>
<a href="#Pointer_variables">Pointer variables</a><ol><li>
<a href="#Declaring_a_pointer_variable">Declaring a pointer variable</a></li><li>
<a href="#Assigning_to_pointer_variables">Assigning to pointer variables</a></li><li>
<a href="#Using_a_pointer">Using a pointer</a></li><li>
<a href="#Printing_pointers">Printing pointers</a></li></ol></li><li>
<a href="#The_null_pointer">The null pointer</a></li><li>
<a href="#Pointers_and_functions">Pointers and functions</a></li><li>
<a href="#Pointer_arithmetic_and_arrays">Pointer arithmetic and arrays</a><ol><li>
<a href="#Arrays_and_functions">Arrays and functions</a></li><li>
<a href="#Multidimensional_arrays">Multidimensional arrays</a></li><li>
<a href="#Variable-length_arrays">Variable-length arrays</a></li></ol></li><li>
<a href="#Void_pointers">Void pointers</a></li><li>
<a href="#Run-time_storage_allocation">Run-time storage allocation</a></li><li>
<a href="#The_restrict_keyword">The restrict keyword</a></li></ol></div> <span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867">
</p><h1 id="Memory_and_addresses">1. Memory and addresses</h1>
<span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line874">Memory in a typical modern computer is divided into two classes: a small <span class="anchor" id="line-6"></span>number of <strong>registers</strong>, which live on the CPU chip and perform specialized <span class="anchor" id="line-7"></span>functions like keeping track of the location of the next machine code <span class="anchor" id="line-8"></span>instruction to execute or the current stack frame, and <strong>main memory</strong>,
 which (mostly) lives outside the CPU chip and which stores the code and
 data of a running program.  When the CPU wants to fetch a value from a 
particular location in main memory, it must supply an address: a 32-bit 
or 64-bit unsigned integer on typical current architectures, referring 
to one of up to 2<sup>32</sup> or 2<sup>64</sup> distinct 8-bit locations in the memory.  These integers can be manipulated like any other integer; in C, they appear as <strong>pointers</strong>, a family of types that can be passed as arguments, stored in variables, returned from functions, etc. <span class="anchor" id="line-9"></span><span class="anchor" id="line-10"></span></p><p class="line867">
</p><h1 id="Pointer_variables">2. Pointer variables</h1>
<span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span><p class="line867">
</p><h2 id="Declaring_a_pointer_variable">2.1. Declaring a pointer variable</h2>
<span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span><p class="line862">The
 convention is C is that the declaration of a complex type looks like 
its use.  To declare a pointer-valued variable, write a declaration for 
the thing that it points to, but include a <tt class="backtick">*</tt> before the variable name: <span class="anchor" id="line-15"></span><span class="anchor" id="line-16"></span></p><p class="line867"><span class="anchor" id="line-17"></span><span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><span class="anchor" id="line-1-1"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
function isnumbered(obj) {
  return obj.childNodes.length && obj.firstChild.childNodes.length && obj.firstChild.firstChild.className == 'LineNumber';
}
function nformat(num,chrs,add) {
  var nlen = Math.max(0,chrs-(''+num).length), res = '';
  while (nlen>0) { res += ' '; nlen-- }
  return res+num+add;
}
function addnumber(did, nstart, nstep) {
  var c = document.getElementById(did), l = c.firstChild, n = 1;
  if (!isnumbered(c)) {
    if (typeof nstart == 'undefined') nstart = 1;
    if (typeof nstep  == 'undefined') nstep = 1;
    var n = nstart;
    while (l != null) {
      if (l.tagName == 'SPAN') {
        var s = document.createElement('SPAN');
        var a = document.createElement('A');
        s.className = 'LineNumber';
        a.appendChild(document.createTextNode(nformat(n,4,'')));
        a.href = '#' + did + '_' + n;
        s.appendChild(a);
        s.appendChild(document.createTextNode(' '));
        n += nstep;
        if (l.childNodes.length) {
          l.insertBefore(s, l.firstChild);
        }
        else {
          l.appendChild(s);
        }
      }
      l = l.nextSibling;
    }
  }
  return false;
}
function remnumber(did) {
  var c = document.getElementById(did), l = c.firstChild;
  if (isnumbered(c)) {
    while (l != null) {
      if (l.tagName == 'SPAN' && l.firstChild.className == 'LineNumber') l.removeChild(l.firstChild);
      l = l.nextSibling;
    }
  }
  return false;
}
function togglenumber(did, nstart, nstep) {
  var c = document.getElementById(did);
  if (isnumbered(c)) {
    remnumber(did);
  } else {
    addnumber(did,nstart,nstep);
  }
  return false;
}
</script>

<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-e1bd38ebbd0f878c8ee50cf1b31433e7188cb7f2\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-e1bd38ebbd0f878c8ee50cf1b31433e7188cb7f2', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-e1bd38ebbd0f878c8ee50cf1b31433e7188cb7f2" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-e1bd38ebbd0f878c8ee50cf1b31433e7188cb7f2_1">   1</a> </span><span class="LineAnchor" id="CA-e1bd38ebbd0f878c8ee50cf1b31433e7188cb7f2_1"></span><span class="anchor" id="line-1-2"></span>    <span class="ResWord">int</span> *<span class="ID">pointerToInt</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-e1bd38ebbd0f878c8ee50cf1b31433e7188cb7f2_2">   2</a> </span><span class="LineAnchor" id="CA-e1bd38ebbd0f878c8ee50cf1b31433e7188cb7f2_2"></span><span class="anchor" id="line-2-1"></span>    <span class="ResWord">double</span> *<span class="ID">pointerToDouble</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-e1bd38ebbd0f878c8ee50cf1b31433e7188cb7f2_3">   3</a> </span><span class="LineAnchor" id="CA-e1bd38ebbd0f878c8ee50cf1b31433e7188cb7f2_3"></span><span class="anchor" id="line-3-1"></span>    <span class="ResWord">char</span> *<span class="ID">pointerToChar</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-e1bd38ebbd0f878c8ee50cf1b31433e7188cb7f2_4">   4</a> </span><span class="LineAnchor" id="CA-e1bd38ebbd0f878c8ee50cf1b31433e7188cb7f2_4"></span><span class="anchor" id="line-4-1"></span>    <span class="ResWord">char</span> **<span class="ID">pointerToPointerToChar</span>;</span>
</pre></div></div><span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line867">
</p><h2 id="Assigning_to_pointer_variables">2.2. Assigning to pointer variables</h2>
<span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><p class="line862">Declaring a pointer-valued variable allocates space to hold the pointer but <em>not</em>
 to hold anything it points to.  Like any other variable in C, a 
pointer-valued variable will initially contain garbage---in this case, 
the address of a location that might or might not contain something 
important.  To initialize a pointer variable, you have to assign to it 
the address of something that already exists.  Typically this is done 
using the <tt class="backtick">&amp;</tt> (<strong>address-of</strong>) operator: <span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span></p><p class="line867"><span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span><span class="anchor" id="line-1-3"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-aaca6a4caad683555349edb782c9a6fc710773d8\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-aaca6a4caad683555349edb782c9a6fc710773d8', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-aaca6a4caad683555349edb782c9a6fc710773d8" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-aaca6a4caad683555349edb782c9a6fc710773d8_1">   1</a> </span><span class="LineAnchor" id="CA-aaca6a4caad683555349edb782c9a6fc710773d8_1"></span><span class="anchor" id="line-1-4"></span>    <span class="ResWord">int</span> <span class="ID">n</span>;              <span class="Comment">/* an int variable */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-aaca6a4caad683555349edb782c9a6fc710773d8_2">   2</a> </span><span class="LineAnchor" id="CA-aaca6a4caad683555349edb782c9a6fc710773d8_2"></span><span class="anchor" id="line-2-2"></span>    <span class="ResWord">int</span> *<span class="ID">p</span>;             <span class="Comment">/* a pointer to an int */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-aaca6a4caad683555349edb782c9a6fc710773d8_3">   3</a> </span><span class="LineAnchor" id="CA-aaca6a4caad683555349edb782c9a6fc710773d8_3"></span><span class="anchor" id="line-3-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-aaca6a4caad683555349edb782c9a6fc710773d8_4">   4</a> </span><span class="LineAnchor" id="CA-aaca6a4caad683555349edb782c9a6fc710773d8_4"></span><span class="anchor" id="line-4-2"></span>    <span class="ID">p</span> = &amp;<span class="ID">n</span>;             <span class="Comment">/* p now points to n */</span></span>
</pre></div></div><span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><p class="line867">
</p><h2 id="Using_a_pointer">2.3. Using a pointer</h2>
<span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span><p class="line874">Pointer
 variables can be used in two ways: to get their value (a pointer), e.g.
 if you want to assign an address to more than one pointer variable: <span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span></p><p class="line867"><span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><span class="anchor" id="line-1-5"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-3a9380054e4ba5716795620bb9a8325d11f544c0\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-3a9380054e4ba5716795620bb9a8325d11f544c0', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-3a9380054e4ba5716795620bb9a8325d11f544c0" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-3a9380054e4ba5716795620bb9a8325d11f544c0_1">   1</a> </span><span class="LineAnchor" id="CA-3a9380054e4ba5716795620bb9a8325d11f544c0_1"></span><span class="anchor" id="line-1-6"></span>    <span class="ResWord">int</span> <span class="ID">n</span>;              <span class="Comment">/* an int variable */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-3a9380054e4ba5716795620bb9a8325d11f544c0_2">   2</a> </span><span class="LineAnchor" id="CA-3a9380054e4ba5716795620bb9a8325d11f544c0_2"></span><span class="anchor" id="line-2-3"></span>    <span class="ResWord">int</span> *<span class="ID">p</span>;             <span class="Comment">/* a pointer to an int */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-3a9380054e4ba5716795620bb9a8325d11f544c0_3">   3</a> </span><span class="LineAnchor" id="CA-3a9380054e4ba5716795620bb9a8325d11f544c0_3"></span><span class="anchor" id="line-3-3"></span>    <span class="ResWord">int</span> *<span class="ID">q</span>;             <span class="Comment">/* another pointer to an int */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-3a9380054e4ba5716795620bb9a8325d11f544c0_4">   4</a> </span><span class="LineAnchor" id="CA-3a9380054e4ba5716795620bb9a8325d11f544c0_4"></span><span class="anchor" id="line-4-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-3a9380054e4ba5716795620bb9a8325d11f544c0_5">   5</a> </span><span class="LineAnchor" id="CA-3a9380054e4ba5716795620bb9a8325d11f544c0_5"></span><span class="anchor" id="line-5-1"></span>    <span class="ID">p</span> = &amp;<span class="ID">n</span>;             <span class="Comment">/* p now points to n */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-3a9380054e4ba5716795620bb9a8325d11f544c0_6">   6</a> </span><span class="LineAnchor" id="CA-3a9380054e4ba5716795620bb9a8325d11f544c0_6"></span><span class="anchor" id="line-6-1"></span>    <span class="ID">q</span> = <span class="ID">p</span>;              <span class="Comment">/* q now points to n as well */</span></span>
</pre></div></div><span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><p class="line862">But more often you will want to work on the value stored at the location pointed to.  You can do this by using the <tt class="backtick">*</tt> (<strong>dereference</strong>) operator, which acts as an inverse of the address-of operator: <span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span></p><p class="line867"><span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><span class="anchor" id="line-1-7"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-31588e9c53fe85ee760c53b0cb4930574482eb9f\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-31588e9c53fe85ee760c53b0cb4930574482eb9f', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-31588e9c53fe85ee760c53b0cb4930574482eb9f" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-31588e9c53fe85ee760c53b0cb4930574482eb9f_1">   1</a> </span><span class="LineAnchor" id="CA-31588e9c53fe85ee760c53b0cb4930574482eb9f_1"></span><span class="anchor" id="line-1-8"></span>    <span class="ResWord">int</span> <span class="ID">n</span>;              <span class="Comment">/* an int variable */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-31588e9c53fe85ee760c53b0cb4930574482eb9f_2">   2</a> </span><span class="LineAnchor" id="CA-31588e9c53fe85ee760c53b0cb4930574482eb9f_2"></span><span class="anchor" id="line-2-4"></span>    <span class="ResWord">int</span> *<span class="ID">p</span>;             <span class="Comment">/* a pointer to an int */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-31588e9c53fe85ee760c53b0cb4930574482eb9f_3">   3</a> </span><span class="LineAnchor" id="CA-31588e9c53fe85ee760c53b0cb4930574482eb9f_3"></span><span class="anchor" id="line-3-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-31588e9c53fe85ee760c53b0cb4930574482eb9f_4">   4</a> </span><span class="LineAnchor" id="CA-31588e9c53fe85ee760c53b0cb4930574482eb9f_4"></span><span class="anchor" id="line-4-4"></span>    <span class="ID">p</span> = &amp;<span class="ID">n</span>;             <span class="Comment">/* p now points to n */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-31588e9c53fe85ee760c53b0cb4930574482eb9f_5">   5</a> </span><span class="LineAnchor" id="CA-31588e9c53fe85ee760c53b0cb4930574482eb9f_5"></span><span class="anchor" id="line-5-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-31588e9c53fe85ee760c53b0cb4930574482eb9f_6">   6</a> </span><span class="LineAnchor" id="CA-31588e9c53fe85ee760c53b0cb4930574482eb9f_6"></span><span class="anchor" id="line-6-2"></span>    *<span class="ID">p</span> = <span class="Number">2</span>;             <span class="Comment">/* sets n to 2 */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-31588e9c53fe85ee760c53b0cb4930574482eb9f_7">   7</a> </span><span class="LineAnchor" id="CA-31588e9c53fe85ee760c53b0cb4930574482eb9f_7"></span><span class="anchor" id="line-7-1"></span>    *<span class="ID">p</span> = *<span class="ID">p</span> + *<span class="ID">p</span>;       <span class="Comment">/* sets n to 4 */</span></span>
</pre></div></div><span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><p class="line862">The <tt class="backtick">*</tt> operator binds very tightly, so you can usually use <tt class="backtick">*p</tt> anywhere you could use the variable it points to without worrying about parentheses.  However, a few operators, such as <tt class="backtick">--</tt>, <tt class="backtick">++</tt>, and <tt class="backtick">.</tt> (used in <a href="http://www.cs.yale.edu/homes/aspnes/pinewiki/C%282f%29Structs.html">C/Structs</a>) bind tighter, requiring parantheses if you want the <tt class="backtick">*</tt> to take precedence. <span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span></p><p class="line867"><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><span class="anchor" id="line-1-9"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-aaaac23a8cb13602c10834175921440a664364f1\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-aaaac23a8cb13602c10834175921440a664364f1', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-aaaac23a8cb13602c10834175921440a664364f1" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-aaaac23a8cb13602c10834175921440a664364f1_1">   1</a> </span><span class="LineAnchor" id="CA-aaaac23a8cb13602c10834175921440a664364f1_1"></span><span class="anchor" id="line-1-10"></span>    (*<span class="ID">p</span>)++;             <span class="Comment">/* increment the value pointed to by p */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-aaaac23a8cb13602c10834175921440a664364f1_2">   2</a> </span><span class="LineAnchor" id="CA-aaaac23a8cb13602c10834175921440a664364f1_2"></span><span class="anchor" id="line-2-5"></span>    *<span class="ID">p</span>++;               <span class="Comment">/* WARNING: increments p itself */</span></span>
</pre></div></div><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><p class="line867">
</p><h2 id="Printing_pointers">2.4. Printing pointers</h2>
<span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><p class="line862">You can print a pointer value using <tt class="backtick">printf</tt> with the <tt class="backtick">%p</tt> format specifier.  To do so, you should convert the pointer to type <tt class="backtick">void&nbsp;*</tt> first using a cast (see below for <tt class="backtick">void&nbsp;*</tt>
 pointers), although on machines that don't have different 
representations for different pointer types, this may not be necessary. <span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span></p><p class="line874">Here is a short program that prints out some pointer values: <span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span></p><p class="line867"><span class="anchor" id="line-1-11"></span></p><div class="highlight text"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-e50e4393fdd170a805665e802202bcf33e54cdd5\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-e50e4393fdd170a805665e802202bcf33e54cdd5', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_1">   1</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_1"></span><span class="anchor" id="line-1-12"></span><span class="Preprc">#</span><span class="Preprc">include &lt;stdio.h&gt;</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_2">   2</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_2"></span><span class="anchor" id="line-2-6"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">include &lt;stdlib.h&gt;</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_3">   3</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_3"></span><span class="anchor" id="line-3-5"></span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_4">   4</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_4"></span><span class="anchor" id="line-4-5"></span><span class="ResWord">int</span> <span class="ID">G</span> = <span class="Number">0</span>;   <span class="Comment">/* a global variable, stored in BSS segment */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_5">   5</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_5"></span><span class="anchor" id="line-5-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_6">   6</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_6"></span><span class="anchor" id="line-6-3"></span><span class="ResWord">int</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_7">   7</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_7"></span><span class="anchor" id="line-7-2"></span><span class="ID">main</span>(<span class="ResWord">int</span> <span class="ID">argc</span>, <span class="ResWord">char</span> **<span class="ID">argv</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_8">   8</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_8"></span><span class="anchor" id="line-8-1"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_9">   9</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_9"></span><span class="anchor" id="line-9-1"></span>    <span class="ResWord">static</span> <span class="ResWord">int</span> <span class="ID">s</span>;  <span class="Comment">/* static local variable, stored in BSS segment */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_10">  10</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_10"></span><span class="anchor" id="line-10-1"></span>    <span class="ResWord">int</span> <span class="ID">a</span>;         <span class="Comment">/* automatic variable, stored on stack */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_11">  11</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_11"></span><span class="anchor" id="line-11-1"></span>    <span class="ResWord">int</span> *<span class="ID">p</span>;        <span class="Comment">/* pointer variable for malloc below */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_12">  12</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_12"></span><span class="anchor" id="line-12-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_13">  13</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_13"></span><span class="anchor" id="line-13-1"></span>    <span class="Comment">/* obtain a block big enough for one int from the heap */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_14">  14</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_14"></span><span class="anchor" id="line-14-1"></span>    <span class="ID">p</span> = <span class="ID">malloc</span>(<span class="ResWord">sizeof</span>(<span class="ResWord">int</span>));</span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_15">  15</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_15"></span><span class="anchor" id="line-15-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_16">  16</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_16"></span><span class="anchor" id="line-16-1"></span>    <span class="ID">printf</span>(<span class="String">"</span><span class="String">&amp;G   = %p</span><span class="SPChar">\n</span><span class="String">"</span>, (<span class="ResWord">void</span> *) &amp;<span class="ID">G</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_17">  17</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_17"></span><span class="anchor" id="line-17-1"></span>    <span class="ID">printf</span>(<span class="String">"</span><span class="String">&amp;s   = %p</span><span class="SPChar">\n</span><span class="String">"</span>, (<span class="ResWord">void</span> *) &amp;<span class="ID">s</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_18">  18</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_18"></span><span class="anchor" id="line-18-1"></span>    <span class="ID">printf</span>(<span class="String">"</span><span class="String">&amp;a   = %p</span><span class="SPChar">\n</span><span class="String">"</span>, (<span class="ResWord">void</span> *) &amp;<span class="ID">a</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_19">  19</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_19"></span><span class="anchor" id="line-19-1"></span>    <span class="ID">printf</span>(<span class="String">"</span><span class="String">&amp;p   = %p</span><span class="SPChar">\n</span><span class="String">"</span>, (<span class="ResWord">void</span> *) &amp;<span class="ID">p</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_20">  20</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_20"></span><span class="anchor" id="line-20-1"></span>    <span class="ID">printf</span>(<span class="String">"</span><span class="String">p    = %p</span><span class="SPChar">\n</span><span class="String">"</span>, (<span class="ResWord">void</span> *) <span class="ID">p</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_21">  21</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_21"></span><span class="anchor" id="line-21-1"></span>    <span class="ID">printf</span>(<span class="String">"</span><span class="String">main = %p</span><span class="SPChar">\n</span><span class="String">"</span>, (<span class="ResWord">void</span> *) <span class="ID">main</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_22">  22</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_22"></span><span class="anchor" id="line-22-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_23">  23</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_23"></span><span class="anchor" id="line-23-1"></span>    <span class="ID">free</span>(<span class="ID">p</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_24">  24</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_24"></span><span class="anchor" id="line-24-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_25">  25</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_25"></span><span class="anchor" id="line-25-1"></span>    <span class="ResWord">return</span> <span class="Number">0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-e50e4393fdd170a805665e802202bcf33e54cdd5_26">  26</a> </span><span class="LineAnchor" id="CA-e50e4393fdd170a805665e802202bcf33e54cdd5_26"></span><span class="anchor" id="line-26-1"></span>}</span>
</pre></div></div><a class="attachment" href="http://www.cs.yale.edu/homes/aspnes/pinewiki/attachments/C%282f%29Pointers/looking_at_pointers.c" title="attachment:looking_at_pointers.c">looking_at_pointers.c</a> <span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><p class="line862">When I run this on a Mac OS X 10.6 machine after compiling with <tt class="backtick">gcc</tt>, the output is: <span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span></p><pre><span class="anchor" id="line-1"></span>&amp;G   = 0x100001078
<span class="anchor" id="line-2"></span>&amp;s   = 0x10000107c
<span class="anchor" id="line-3"></span>&amp;a   = 0x7fff5fbff2bc
<span class="anchor" id="line-4"></span>&amp;p   = 0x7fff5fbff2b0
<span class="anchor" id="line-5"></span>p    = 0x100100080
<span class="anchor" id="line-6"></span>main = 0x100000e18</pre><span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><p class="line862">The
 interesting thing here is that we can see how the compiler chooses to 
allocate space for variables based on their storage classes.  The global
 variable <tt class="backtick">G</tt> and the static local variable <tt class="backtick">s</tt> both persist between function calls, so they get placed in the BSS segment (see <a class="interwiki" href="http://en.wikipedia.org/wiki/.bss" title="WikiPedia">.bss</a>) that starts somewhere around <tt class="backtick">0x100000000</tt>, typically after the code segment containing the actual code of the program.  Local variables <tt class="backtick">a</tt> and <tt class="backtick">p</tt> are allocated on the stack, which grows down from somewhere near the top of the address space.  The block that <tt class="backtick">malloc</tt> returns that <tt class="backtick">p</tt>
 points to is allocated off the heap, a region of memory that may also 
grow over time and starts after the BSS segment.  Finally, <tt class="backtick">main</tt> appears at 0x100000e18; this is in the code segment, which is a bit lower in memory than all the global variables. <span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span></p><p class="line867">
</p><h1 id="The_null_pointer">3. The null pointer</h1>
<span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span><p class="line862">The special value <tt class="backtick">0</tt>, known as the <strong>null pointer</strong> may be assigned to a pointer of any type.  It may or may not be represented by the actual address <tt class="backtick">0</tt>, but it will act like <tt class="backtick">0</tt> in all contexts (e.g., it has the value false in an <tt class="backtick">if</tt> or <tt class="backtick">while</tt>
 statement).  Null pointers are often used to indicate missing data or 
failed functions.  Attempting to dereference a null pointer can have 
catastrophic effects, so it's important to be aware of when you might be
 supplied with one. <span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span></p><p class="line867">
</p><h1 id="Pointers_and_functions">4. Pointers and functions</h1>
<span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><p class="line862">A
 simple application of pointers is to get around C's limit on having 
only one return value from a function.  Because C arguments are copied, 
assigning a value to an argument inside a function has no effect on the 
outside.  So the <tt class="backtick">doubler</tt> function below doesn't do much: <span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span></p><p class="line867"><span class="anchor" id="line-1-13"></span></p><div class="highlight text"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_1">   1</a> </span><span class="LineAnchor" id="CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_1"></span><span class="anchor" id="line-1-14"></span><span class="Preprc">#</span><span class="Preprc">include &lt;stdio.h&gt;</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_2">   2</a> </span><span class="LineAnchor" id="CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_2"></span><span class="anchor" id="line-2-7"></span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_3">   3</a> </span><span class="LineAnchor" id="CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_3"></span><span class="anchor" id="line-3-6"></span><span class="Comment">/* doesn't work */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_4">   4</a> </span><span class="LineAnchor" id="CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_4"></span><span class="anchor" id="line-4-6"></span><span class="ResWord">void</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_5">   5</a> </span><span class="LineAnchor" id="CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_5"></span><span class="anchor" id="line-5-4"></span><span class="ID">doubler</span>(<span class="ResWord">int</span> <span class="ID">x</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_6">   6</a> </span><span class="LineAnchor" id="CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_6"></span><span class="anchor" id="line-6-4"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_7">   7</a> </span><span class="LineAnchor" id="CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_7"></span><span class="anchor" id="line-7-3"></span>    <span class="ID">x</span> *= <span class="Number">2</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_8">   8</a> </span><span class="LineAnchor" id="CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_8"></span><span class="anchor" id="line-8-2"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_9">   9</a> </span><span class="LineAnchor" id="CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_9"></span><span class="anchor" id="line-9-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_10">  10</a> </span><span class="LineAnchor" id="CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_10"></span><span class="anchor" id="line-10-2"></span><span class="ResWord">int</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_11">  11</a> </span><span class="LineAnchor" id="CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_11"></span><span class="anchor" id="line-11-2"></span><span class="ID">main</span>(<span class="ResWord">int</span> <span class="ID">argc</span>, <span class="ResWord">char</span> **<span class="ID">argv</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_12">  12</a> </span><span class="LineAnchor" id="CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_12"></span><span class="anchor" id="line-12-2"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_13">  13</a> </span><span class="LineAnchor" id="CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_13"></span><span class="anchor" id="line-13-2"></span>    <span class="ResWord">int</span> <span class="ID">y</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_14">  14</a> </span><span class="LineAnchor" id="CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_14"></span><span class="anchor" id="line-14-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_15">  15</a> </span><span class="LineAnchor" id="CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_15"></span><span class="anchor" id="line-15-2"></span>    <span class="ID">y</span> = <span class="Number">1</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_16">  16</a> </span><span class="LineAnchor" id="CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_16"></span><span class="anchor" id="line-16-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_17">  17</a> </span><span class="LineAnchor" id="CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_17"></span><span class="anchor" id="line-17-2"></span>    <span class="ID">doubler</span>(<span class="ID">y</span>);                 <span class="Comment">/* no effect on y */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_18">  18</a> </span><span class="LineAnchor" id="CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_18"></span><span class="anchor" id="line-18-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_19">  19</a> </span><span class="LineAnchor" id="CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_19"></span><span class="anchor" id="line-19-2"></span>    <span class="ID">printf</span>(<span class="String">"</span><span class="String">%d</span><span class="SPChar">\n</span><span class="String">"</span>, <span class="ID">y</span>);          <span class="Comment">/* prints 1 */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_20">  20</a> </span><span class="LineAnchor" id="CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_20"></span><span class="anchor" id="line-20-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_21">  21</a> </span><span class="LineAnchor" id="CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_21"></span><span class="anchor" id="line-21-2"></span>    <span class="ResWord">return</span> <span class="Number">0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_22">  22</a> </span><span class="LineAnchor" id="CA-828dcf4c0b38b8eea7fc23bdc498166b8c06f41b_22"></span><span class="anchor" id="line-22-2"></span>}</span>
</pre></div></div><a class="attachment" href="http://www.cs.yale.edu/homes/aspnes/pinewiki/attachments/C%282f%29Pointers/bad_doubler.c" title="attachment:bad_doubler.c">bad_doubler.c</a> <span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><p class="line862">However, if instead of passing the value of <tt class="backtick">y</tt> into <tt class="backtick">doubler</tt> we pass a pointer to <tt class="backtick">y</tt>, then the <tt class="backtick">doubler</tt> function can reach out of its own stack frame to manipulate <tt class="backtick">y</tt> itself: <span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span></p><p class="line867"><span class="anchor" id="line-1-15"></span></p><div class="highlight text"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-ef23e60e295b6da74217ef42aef030b32d54e717\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-ef23e60e295b6da74217ef42aef030b32d54e717', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-ef23e60e295b6da74217ef42aef030b32d54e717" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-ef23e60e295b6da74217ef42aef030b32d54e717_1">   1</a> </span><span class="LineAnchor" id="CA-ef23e60e295b6da74217ef42aef030b32d54e717_1"></span><span class="anchor" id="line-1-16"></span><span class="Preprc">#</span><span class="Preprc">include &lt;stdio.h&gt;</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ef23e60e295b6da74217ef42aef030b32d54e717_2">   2</a> </span><span class="LineAnchor" id="CA-ef23e60e295b6da74217ef42aef030b32d54e717_2"></span><span class="anchor" id="line-2-8"></span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ef23e60e295b6da74217ef42aef030b32d54e717_3">   3</a> </span><span class="LineAnchor" id="CA-ef23e60e295b6da74217ef42aef030b32d54e717_3"></span><span class="anchor" id="line-3-7"></span><span class="Comment">/* doesn't work */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ef23e60e295b6da74217ef42aef030b32d54e717_4">   4</a> </span><span class="LineAnchor" id="CA-ef23e60e295b6da74217ef42aef030b32d54e717_4"></span><span class="anchor" id="line-4-7"></span><span class="ResWord">void</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ef23e60e295b6da74217ef42aef030b32d54e717_5">   5</a> </span><span class="LineAnchor" id="CA-ef23e60e295b6da74217ef42aef030b32d54e717_5"></span><span class="anchor" id="line-5-5"></span><span class="ID">doubler</span>(<span class="ResWord">int</span> *<span class="ID">x</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-ef23e60e295b6da74217ef42aef030b32d54e717_6">   6</a> </span><span class="LineAnchor" id="CA-ef23e60e295b6da74217ef42aef030b32d54e717_6"></span><span class="anchor" id="line-6-5"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-ef23e60e295b6da74217ef42aef030b32d54e717_7">   7</a> </span><span class="LineAnchor" id="CA-ef23e60e295b6da74217ef42aef030b32d54e717_7"></span><span class="anchor" id="line-7-4"></span>    *<span class="ID">x</span> *= <span class="Number">2</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-ef23e60e295b6da74217ef42aef030b32d54e717_8">   8</a> </span><span class="LineAnchor" id="CA-ef23e60e295b6da74217ef42aef030b32d54e717_8"></span><span class="anchor" id="line-8-3"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-ef23e60e295b6da74217ef42aef030b32d54e717_9">   9</a> </span><span class="LineAnchor" id="CA-ef23e60e295b6da74217ef42aef030b32d54e717_9"></span><span class="anchor" id="line-9-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ef23e60e295b6da74217ef42aef030b32d54e717_10">  10</a> </span><span class="LineAnchor" id="CA-ef23e60e295b6da74217ef42aef030b32d54e717_10"></span><span class="anchor" id="line-10-3"></span><span class="ResWord">int</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ef23e60e295b6da74217ef42aef030b32d54e717_11">  11</a> </span><span class="LineAnchor" id="CA-ef23e60e295b6da74217ef42aef030b32d54e717_11"></span><span class="anchor" id="line-11-3"></span><span class="ID">main</span>(<span class="ResWord">int</span> <span class="ID">argc</span>, <span class="ResWord">char</span> **<span class="ID">argv</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-ef23e60e295b6da74217ef42aef030b32d54e717_12">  12</a> </span><span class="LineAnchor" id="CA-ef23e60e295b6da74217ef42aef030b32d54e717_12"></span><span class="anchor" id="line-12-3"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-ef23e60e295b6da74217ef42aef030b32d54e717_13">  13</a> </span><span class="LineAnchor" id="CA-ef23e60e295b6da74217ef42aef030b32d54e717_13"></span><span class="anchor" id="line-13-3"></span>    <span class="ResWord">int</span> <span class="ID">y</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-ef23e60e295b6da74217ef42aef030b32d54e717_14">  14</a> </span><span class="LineAnchor" id="CA-ef23e60e295b6da74217ef42aef030b32d54e717_14"></span><span class="anchor" id="line-14-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ef23e60e295b6da74217ef42aef030b32d54e717_15">  15</a> </span><span class="LineAnchor" id="CA-ef23e60e295b6da74217ef42aef030b32d54e717_15"></span><span class="anchor" id="line-15-3"></span>    <span class="ID">y</span> = <span class="Number">1</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-ef23e60e295b6da74217ef42aef030b32d54e717_16">  16</a> </span><span class="LineAnchor" id="CA-ef23e60e295b6da74217ef42aef030b32d54e717_16"></span><span class="anchor" id="line-16-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ef23e60e295b6da74217ef42aef030b32d54e717_17">  17</a> </span><span class="LineAnchor" id="CA-ef23e60e295b6da74217ef42aef030b32d54e717_17"></span><span class="anchor" id="line-17-3"></span>    <span class="ID">doubler</span>(&amp;<span class="ID">y</span>);                <span class="Comment">/* sets y to 2 */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ef23e60e295b6da74217ef42aef030b32d54e717_18">  18</a> </span><span class="LineAnchor" id="CA-ef23e60e295b6da74217ef42aef030b32d54e717_18"></span><span class="anchor" id="line-18-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ef23e60e295b6da74217ef42aef030b32d54e717_19">  19</a> </span><span class="LineAnchor" id="CA-ef23e60e295b6da74217ef42aef030b32d54e717_19"></span><span class="anchor" id="line-19-3"></span>    <span class="ID">printf</span>(<span class="String">"</span><span class="String">%d</span><span class="SPChar">\n</span><span class="String">"</span>, <span class="ID">y</span>);          <span class="Comment">/* prints 2 */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ef23e60e295b6da74217ef42aef030b32d54e717_20">  20</a> </span><span class="LineAnchor" id="CA-ef23e60e295b6da74217ef42aef030b32d54e717_20"></span><span class="anchor" id="line-20-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ef23e60e295b6da74217ef42aef030b32d54e717_21">  21</a> </span><span class="LineAnchor" id="CA-ef23e60e295b6da74217ef42aef030b32d54e717_21"></span><span class="anchor" id="line-21-3"></span>    <span class="ResWord">return</span> <span class="Number">0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-ef23e60e295b6da74217ef42aef030b32d54e717_22">  22</a> </span><span class="LineAnchor" id="CA-ef23e60e295b6da74217ef42aef030b32d54e717_22"></span><span class="anchor" id="line-22-3"></span>}</span>
</pre></div></div><a class="attachment" href="http://www.cs.yale.edu/homes/aspnes/pinewiki/attachments/C%282f%29Pointers/good_doubler.c" title="attachment:good_doubler.c">good_doubler.c</a> <span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><p class="line862">Generally, if you pass the value of a variable into a function (with no <tt class="backtick">&amp;</tt>),
 you can be assured that the function can't modify your original 
variable.  When you pass a pointer, you should assume that the function 
can and will change the variable's value.  If you want to write a 
function that takes a pointer argument but promises not to modify the 
target of the pointer, use <tt class="backtick">const</tt>, like this: <span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span></p><p class="line867"><span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><span class="anchor" id="line-1-17"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-f39d3e81c15543be8ae2915e3c58c52a8c5dd0ab\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-f39d3e81c15543be8ae2915e3c58c52a8c5dd0ab', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-f39d3e81c15543be8ae2915e3c58c52a8c5dd0ab" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-f39d3e81c15543be8ae2915e3c58c52a8c5dd0ab_1">   1</a> </span><span class="LineAnchor" id="CA-f39d3e81c15543be8ae2915e3c58c52a8c5dd0ab_1"></span><span class="anchor" id="line-1-18"></span><span class="ResWord">void</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f39d3e81c15543be8ae2915e3c58c52a8c5dd0ab_2">   2</a> </span><span class="LineAnchor" id="CA-f39d3e81c15543be8ae2915e3c58c52a8c5dd0ab_2"></span><span class="anchor" id="line-2-9"></span><span class="ID">printPointerTarget</span>(<span class="ResWord">const</span> <span class="ResWord">int</span> *<span class="ID">p</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-f39d3e81c15543be8ae2915e3c58c52a8c5dd0ab_3">   3</a> </span><span class="LineAnchor" id="CA-f39d3e81c15543be8ae2915e3c58c52a8c5dd0ab_3"></span><span class="anchor" id="line-3-8"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-f39d3e81c15543be8ae2915e3c58c52a8c5dd0ab_4">   4</a> </span><span class="LineAnchor" id="CA-f39d3e81c15543be8ae2915e3c58c52a8c5dd0ab_4"></span><span class="anchor" id="line-4-8"></span>    <span class="ID">printf</span>(<span class="String">"</span><span class="String">%d</span><span class="SPChar">\n</span><span class="String">"</span>, *<span class="ID">p</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-f39d3e81c15543be8ae2915e3c58c52a8c5dd0ab_5">   5</a> </span><span class="LineAnchor" id="CA-f39d3e81c15543be8ae2915e3c58c52a8c5dd0ab_5"></span><span class="anchor" id="line-5-6"></span>}</span>
</pre></div></div><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><p class="line862">The <tt class="backtick">const</tt>
 qualifier tells the compiler that the target of the pointer shouldn't 
be modified.  This will cause it to return an error if you try to assign
 to it anyway: <span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span></p><p class="line867"><span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><span class="anchor" id="line-1-19"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-507c5952d0f38125e40636daef05eed8f93ac7f2\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-507c5952d0f38125e40636daef05eed8f93ac7f2', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-507c5952d0f38125e40636daef05eed8f93ac7f2" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-507c5952d0f38125e40636daef05eed8f93ac7f2_1">   1</a> </span><span class="LineAnchor" id="CA-507c5952d0f38125e40636daef05eed8f93ac7f2_1"></span><span class="anchor" id="line-1-20"></span><span class="ResWord">void</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-507c5952d0f38125e40636daef05eed8f93ac7f2_2">   2</a> </span><span class="LineAnchor" id="CA-507c5952d0f38125e40636daef05eed8f93ac7f2_2"></span><span class="anchor" id="line-2-10"></span><span class="ID">printPointerTarget</span>(<span class="ResWord">const</span> <span class="ResWord">int</span> *<span class="ID">p</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-507c5952d0f38125e40636daef05eed8f93ac7f2_3">   3</a> </span><span class="LineAnchor" id="CA-507c5952d0f38125e40636daef05eed8f93ac7f2_3"></span><span class="anchor" id="line-3-9"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-507c5952d0f38125e40636daef05eed8f93ac7f2_4">   4</a> </span><span class="LineAnchor" id="CA-507c5952d0f38125e40636daef05eed8f93ac7f2_4"></span><span class="anchor" id="line-4-9"></span>    *<span class="ID">p</span> = <span class="Number">5</span>;  <span class="Comment">/* produces compile-time error */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-507c5952d0f38125e40636daef05eed8f93ac7f2_5">   5</a> </span><span class="LineAnchor" id="CA-507c5952d0f38125e40636daef05eed8f93ac7f2_5"></span><span class="anchor" id="line-5-7"></span>    <span class="ID">printf</span>(<span class="String">"</span><span class="String">%d</span><span class="SPChar">\n</span><span class="String">"</span>, *<span class="ID">p</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-507c5952d0f38125e40636daef05eed8f93ac7f2_6">   6</a> </span><span class="LineAnchor" id="CA-507c5952d0f38125e40636daef05eed8f93ac7f2_6"></span><span class="anchor" id="line-6-6"></span>}</span>
</pre></div></div><span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><p class="line862">Passing <tt class="backtick">const</tt>
 pointers is mostly used when passing large structures to functions, 
where copying a 32-bit pointer is cheaper than copying the thing it 
points to. <span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span></p><p class="line862">If you really want to modify the target anyway, C lets you "cast away <tt class="backtick">const</tt>": <span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><span class="anchor" id="line-1-21"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-16f23eb09ee877e821d0a5d6bac035d1937d7589\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-16f23eb09ee877e821d0a5d6bac035d1937d7589', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-16f23eb09ee877e821d0a5d6bac035d1937d7589" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-16f23eb09ee877e821d0a5d6bac035d1937d7589_1">   1</a> </span><span class="LineAnchor" id="CA-16f23eb09ee877e821d0a5d6bac035d1937d7589_1"></span><span class="anchor" id="line-1-22"></span><span class="ResWord">void</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-16f23eb09ee877e821d0a5d6bac035d1937d7589_2">   2</a> </span><span class="LineAnchor" id="CA-16f23eb09ee877e821d0a5d6bac035d1937d7589_2"></span><span class="anchor" id="line-2-11"></span><span class="ID">printPointerTarget</span>(<span class="ResWord">const</span> <span class="ResWord">int</span> *<span class="ID">p</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-16f23eb09ee877e821d0a5d6bac035d1937d7589_3">   3</a> </span><span class="LineAnchor" id="CA-16f23eb09ee877e821d0a5d6bac035d1937d7589_3"></span><span class="anchor" id="line-3-10"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-16f23eb09ee877e821d0a5d6bac035d1937d7589_4">   4</a> </span><span class="LineAnchor" id="CA-16f23eb09ee877e821d0a5d6bac035d1937d7589_4"></span><span class="anchor" id="line-4-10"></span>    *((<span class="ResWord">int</span> *) <span class="ID">p</span>) = <span class="Number">5</span>;  <span class="Comment">/* produces compile-time error */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-16f23eb09ee877e821d0a5d6bac035d1937d7589_5">   5</a> </span><span class="LineAnchor" id="CA-16f23eb09ee877e821d0a5d6bac035d1937d7589_5"></span><span class="anchor" id="line-5-8"></span>    <span class="ID">printf</span>(<span class="String">"</span><span class="String">%d</span><span class="SPChar">\n</span><span class="String">"</span>, *<span class="ID">p</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-16f23eb09ee877e821d0a5d6bac035d1937d7589_6">   6</a> </span><span class="LineAnchor" id="CA-16f23eb09ee877e821d0a5d6bac035d1937d7589_6"></span><span class="anchor" id="line-6-7"></span>}</span>
</pre></div></div><span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><p class="line862">There is usually no good reason to do this; the one exception might be if the target of the pointer represents an <a class="nonexistent" href="http://www.cs.yale.edu/homes/aspnes/pinewiki/AbstractDataType.html">AbstractDataType</a>,
 and you want to modify its representation during some operation to 
optimize things somehow in a way that will not be visible outside the 
abstraction barrier, making it appear to leave the target constant. <span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span></p><p class="line862">Note
 that while it is safe to pass pointers down into functions, it is very 
dangerous to pass pointers up.  The reason is that the space used to 
hold any local variable of the function will be reclaimed when the 
function exits, but the pointer will still point to the same location, <em>even though something else may now be stored there</em>.  So this function is very dangerous: <span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span></p><p class="line867"><span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><span class="anchor" id="line-1-23"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-a49dc1b1550db33f0713918e931759e7512918e9\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-a49dc1b1550db33f0713918e931759e7512918e9', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-a49dc1b1550db33f0713918e931759e7512918e9" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-a49dc1b1550db33f0713918e931759e7512918e9_1">   1</a> </span><span class="LineAnchor" id="CA-a49dc1b1550db33f0713918e931759e7512918e9_1"></span><span class="anchor" id="line-1-24"></span><span class="ResWord">int</span> *</span>
<span class="line"><span class="LineNumber"><a href="#CA-a49dc1b1550db33f0713918e931759e7512918e9_2">   2</a> </span><span class="LineAnchor" id="CA-a49dc1b1550db33f0713918e931759e7512918e9_2"></span><span class="anchor" id="line-2-12"></span><span class="ID">dangerous</span>(<span class="ResWord">void</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-a49dc1b1550db33f0713918e931759e7512918e9_3">   3</a> </span><span class="LineAnchor" id="CA-a49dc1b1550db33f0713918e931759e7512918e9_3"></span><span class="anchor" id="line-3-11"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-a49dc1b1550db33f0713918e931759e7512918e9_4">   4</a> </span><span class="LineAnchor" id="CA-a49dc1b1550db33f0713918e931759e7512918e9_4"></span><span class="anchor" id="line-4-11"></span>    <span class="ResWord">int</span> <span class="ID">n</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-a49dc1b1550db33f0713918e931759e7512918e9_5">   5</a> </span><span class="LineAnchor" id="CA-a49dc1b1550db33f0713918e931759e7512918e9_5"></span><span class="anchor" id="line-5-9"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-a49dc1b1550db33f0713918e931759e7512918e9_6">   6</a> </span><span class="LineAnchor" id="CA-a49dc1b1550db33f0713918e931759e7512918e9_6"></span><span class="anchor" id="line-6-8"></span>    <span class="ResWord">return</span> &amp;<span class="ID">n</span>;          <span class="Comment">/* NO! */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-a49dc1b1550db33f0713918e931759e7512918e9_7">   7</a> </span><span class="LineAnchor" id="CA-a49dc1b1550db33f0713918e931759e7512918e9_7"></span><span class="anchor" id="line-7-5"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-a49dc1b1550db33f0713918e931759e7512918e9_8">   8</a> </span><span class="LineAnchor" id="CA-a49dc1b1550db33f0713918e931759e7512918e9_8"></span><span class="anchor" id="line-8-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-a49dc1b1550db33f0713918e931759e7512918e9_9">   9</a> </span><span class="LineAnchor" id="CA-a49dc1b1550db33f0713918e931759e7512918e9_9"></span><span class="anchor" id="line-9-4"></span>...</span>
<span class="line"><span class="LineNumber"><a href="#CA-a49dc1b1550db33f0713918e931759e7512918e9_10">  10</a> </span><span class="LineAnchor" id="CA-a49dc1b1550db33f0713918e931759e7512918e9_10"></span><span class="anchor" id="line-10-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-a49dc1b1550db33f0713918e931759e7512918e9_11">  11</a> </span><span class="LineAnchor" id="CA-a49dc1b1550db33f0713918e931759e7512918e9_11"></span><span class="anchor" id="line-11-4"></span>    *<span class="ID">dangerous</span>() = <span class="Number">12</span>;  <span class="Comment">/* writes 12 to some unknown location */</span></span>
</pre></div></div><span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><p class="line862">An
 exception is when you can guarantee that the location pointed to will 
survive even after the function exits, e.g. when the location is 
dynamically allocated using <tt class="backtick">malloc</tt> (see below) or when the local variable is declared <tt class="backtick">static</tt>: <span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span></p><p class="line867"><span class="anchor" id="line-154"></span><span class="anchor" id="line-155"></span><span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span><span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span><span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span><span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><span class="anchor" id="line-1-25"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-52bfbd678b23eed333c2385f9d177bb8fe631309\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-52bfbd678b23eed333c2385f9d177bb8fe631309', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-52bfbd678b23eed333c2385f9d177bb8fe631309" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-52bfbd678b23eed333c2385f9d177bb8fe631309_1">   1</a> </span><span class="LineAnchor" id="CA-52bfbd678b23eed333c2385f9d177bb8fe631309_1"></span><span class="anchor" id="line-1-26"></span><span class="ResWord">int</span> *</span>
<span class="line"><span class="LineNumber"><a href="#CA-52bfbd678b23eed333c2385f9d177bb8fe631309_2">   2</a> </span><span class="LineAnchor" id="CA-52bfbd678b23eed333c2385f9d177bb8fe631309_2"></span><span class="anchor" id="line-2-13"></span><span class="ID">returnStatic</span>(<span class="ResWord">void</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-52bfbd678b23eed333c2385f9d177bb8fe631309_3">   3</a> </span><span class="LineAnchor" id="CA-52bfbd678b23eed333c2385f9d177bb8fe631309_3"></span><span class="anchor" id="line-3-12"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-52bfbd678b23eed333c2385f9d177bb8fe631309_4">   4</a> </span><span class="LineAnchor" id="CA-52bfbd678b23eed333c2385f9d177bb8fe631309_4"></span><span class="anchor" id="line-4-12"></span>    <span class="ResWord">static</span> <span class="ResWord">int</span> <span class="ID">n</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-52bfbd678b23eed333c2385f9d177bb8fe631309_5">   5</a> </span><span class="LineAnchor" id="CA-52bfbd678b23eed333c2385f9d177bb8fe631309_5"></span><span class="anchor" id="line-5-10"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-52bfbd678b23eed333c2385f9d177bb8fe631309_6">   6</a> </span><span class="LineAnchor" id="CA-52bfbd678b23eed333c2385f9d177bb8fe631309_6"></span><span class="anchor" id="line-6-9"></span>    <span class="ResWord">return</span> &amp;<span class="ID">n</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-52bfbd678b23eed333c2385f9d177bb8fe631309_7">   7</a> </span><span class="LineAnchor" id="CA-52bfbd678b23eed333c2385f9d177bb8fe631309_7"></span><span class="anchor" id="line-7-6"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-52bfbd678b23eed333c2385f9d177bb8fe631309_8">   8</a> </span><span class="LineAnchor" id="CA-52bfbd678b23eed333c2385f9d177bb8fe631309_8"></span><span class="anchor" id="line-8-5"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-52bfbd678b23eed333c2385f9d177bb8fe631309_9">   9</a> </span><span class="LineAnchor" id="CA-52bfbd678b23eed333c2385f9d177bb8fe631309_9"></span><span class="anchor" id="line-9-5"></span>...</span>
<span class="line"><span class="LineNumber"><a href="#CA-52bfbd678b23eed333c2385f9d177bb8fe631309_10">  10</a> </span><span class="LineAnchor" id="CA-52bfbd678b23eed333c2385f9d177bb8fe631309_10"></span><span class="anchor" id="line-10-5"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-52bfbd678b23eed333c2385f9d177bb8fe631309_11">  11</a> </span><span class="LineAnchor" id="CA-52bfbd678b23eed333c2385f9d177bb8fe631309_11"></span><span class="anchor" id="line-11-5"></span>    *<span class="ID">returnStatic</span>() = <span class="Number">12</span>;       <span class="Comment">/* writes 12 to the hidden static variable */</span></span>
</pre></div></div><span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span><p class="line862">Usually returning a pointer to a <tt class="backtick">static</tt>
 local variable is not good practice, since the point of making a 
variable local is to keep outsiders from getting at it.  If you find 
yourself tempted to do this, a better approach is to allocate a new 
block using <tt class="backtick">malloc</tt> (see below) and return a pointer to that.  The downside of the <tt class="backtick">malloc</tt> method is that the caller has to promise to call <tt class="backtick">free</tt> on the block later, or you will get a storage leak. <span class="anchor" id="line-168"></span><span class="anchor" id="line-169"></span></p><p class="line867">
</p><h1 id="Pointer_arithmetic_and_arrays">5. Pointer arithmetic and arrays</h1>
<span class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span><p class="line874">Because pointers are just numerical values, one can do arithmetic on them.  Specifically, it is permitted to <span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span></p><ul><li><p class="line862">Add an integer to a pointer or subtract an integer from a pointer.  The effect of <tt class="backtick">p+n</tt> where <tt class="backtick">p</tt> is a pointer and <tt class="backtick">n</tt> is an integer is to compute the address equal to <tt class="backtick">p</tt> plus <tt class="backtick">n</tt> times the size of whatever <tt class="backtick">p</tt> points to (this is why <tt class="backtick">int&nbsp;*</tt> pointers and <tt class="backtick">char&nbsp;*</tt> pointers aren't the same). <span class="anchor" id="line-174"></span></p></li><li><p class="line862">Subtract one pointer from another.  The two pointers must have the same type (e.g. both <tt class="backtick">int&nbsp;*</tt> or both <tt class="backtick">char&nbsp;*</tt>).
  The result is an integer value, equal to the numerical difference 
between the addresses divided by the size of the objects pointed to. <span class="anchor" id="line-175"></span></p></li><li><p class="line862">Compare two pointers using <tt class="backtick">==</tt>, <tt class="backtick">!=</tt>, <tt class="backtick">&lt;</tt>, <tt class="backtick">&gt;</tt>, <tt class="backtick">&lt;=</tt>, or <tt class="backtick">&gt;=</tt>. <span class="anchor" id="line-176"></span></p></li><li><p class="line862">Increment or decrement a pointer using <tt class="backtick">++</tt> or <tt class="backtick">--</tt>. <span class="anchor" id="line-177"></span><span class="anchor" id="line-178"></span></p></li></ul><p class="line862">The main application of pointer arithmetic in C is in <strong>arrays</strong>.
  An array is a block of memory that holds one or more objects of a 
given type.  It is declared by giving the type of object the array holds
 followed by the array name and the size in square brackets: <span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span></p><p class="line867"><span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span><span class="anchor" id="line-183"></span><span class="anchor" id="line-1-27"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-3a0cbcdee537c5bf28131828433910d083717b17\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-3a0cbcdee537c5bf28131828433910d083717b17', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-3a0cbcdee537c5bf28131828433910d083717b17" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-3a0cbcdee537c5bf28131828433910d083717b17_1">   1</a> </span><span class="LineAnchor" id="CA-3a0cbcdee537c5bf28131828433910d083717b17_1"></span><span class="anchor" id="line-1-28"></span>    <span class="ResWord">int</span> <span class="ID">a</span>[<span class="Number">50</span>];          <span class="Comment">/* array of 50 ints */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-3a0cbcdee537c5bf28131828433910d083717b17_2">   2</a> </span><span class="LineAnchor" id="CA-3a0cbcdee537c5bf28131828433910d083717b17_2"></span><span class="anchor" id="line-2-14"></span>    <span class="ResWord">char</span> *<span class="ID">cp</span>[<span class="Number">100</span>];      <span class="Comment">/* array of 100 pointers to char */</span></span>
</pre></div></div><span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span><p class="line862">Declaring an array allocates enough space to hold the specified number of objects (e.g. 200 bytes for <tt class="backtick">a</tt> above and 400 for <tt class="backtick">cp</tt>---note that a <tt class="backtick">char&nbsp;*</tt> is an address, so it is much bigger than a <tt class="backtick">char</tt>).  The number inside the square brackets must be a constant whose value can be determined at compile time. <span class="anchor" id="line-186"></span><span class="anchor" id="line-187"></span></p><p class="line862">The
 array name acts like a constant pointer to the zeroth element of the 
array.  It is thus possible to set or read the zeroth element using <tt class="backtick">*a</tt>.  But because the array name is constant, you can't assign to it: <span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span></p><p class="line867"><span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span><span class="anchor" id="line-192"></span><span class="anchor" id="line-193"></span><span class="anchor" id="line-1-29"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-a8b1bde0695f376f17ca024006f807c5db417677\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-a8b1bde0695f376f17ca024006f807c5db417677', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-a8b1bde0695f376f17ca024006f807c5db417677" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-a8b1bde0695f376f17ca024006f807c5db417677_1">   1</a> </span><span class="LineAnchor" id="CA-a8b1bde0695f376f17ca024006f807c5db417677_1"></span><span class="anchor" id="line-1-30"></span>    *<span class="ID">a</span> = <span class="Number">12</span>;            <span class="Comment">/* sets zeroth element to 12 */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-a8b1bde0695f376f17ca024006f807c5db417677_2">   2</a> </span><span class="LineAnchor" id="CA-a8b1bde0695f376f17ca024006f807c5db417677_2"></span><span class="anchor" id="line-2-15"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-a8b1bde0695f376f17ca024006f807c5db417677_3">   3</a> </span><span class="LineAnchor" id="CA-a8b1bde0695f376f17ca024006f807c5db417677_3"></span><span class="anchor" id="line-3-13"></span>    <span class="ID">a</span> = &amp;<span class="ID">n</span>;             <span class="Comment">/* #### DOESN'T WORK #### */</span></span>
</pre></div></div><span class="anchor" id="line-194"></span><span class="anchor" id="line-195"></span><p class="line862">More common is to use square brackets to refer to a particular element of the array.  The expression <tt class="backtick">a[n]</tt> is defined to be equivalent to <tt class="backtick">*(a+n)</tt>; the <strong>index</strong> <tt class="backtick">n</tt> (an integer) is added to the base of the array (a pointer), to get to the location of the <tt class="backtick">n</tt>-th element of <tt class="backtick">a</tt>.  The implicit <tt class="backtick">*</tt>
 then dereferences this location so that you can read its value (in a 
normal expression) or assign to it (on the left-hand side of an 
assignment operator).  The effect is to allow you to use <tt class="backtick">a[n]</tt> just as you would any other variable of type <tt class="backtick">int</tt> (or whatever type <tt class="backtick">a</tt> was declared as). <span class="anchor" id="line-196"></span><span class="anchor" id="line-197"></span></p><p class="line862">Note that C doesn't do any sort of bounds checking.  Given the declaration <tt class="backtick">int&nbsp;a[50];</tt>, only indices from <tt class="backtick">a[0]</tt> to <tt class="backtick">a[49]</tt> can be used safely.  However, the compiler will not blink at <tt class="backtick">a[-12]</tt> or <tt class="backtick">a[10000]</tt>.
  If you read from such a location you will get garbage data; if you 
write to it, you will overwrite god-knows-what, possibly trashing some 
other variable somewhere else in your program or some critical part of 
the stack (like the location to jump to when you return from a 
function).  It is up to you as a programmer to avoid such <strong>buffer overruns</strong>, which can lead to very mysterious (and in the case of code that gets input from a network, security-damaging) bugs.  The <tt class="backtick">valgrind</tt> program can help detect such overruns in some cases (see <a href="http://www.cs.yale.edu/homes/aspnes/pinewiki/C%282f%29valgrind.html">C/valgrind</a>). <span class="anchor" id="line-198"></span><span class="anchor" id="line-199"></span></p><p class="line862">Another curious feature of the definition of <tt class="backtick">a[n]</tt> as identical to <tt class="backtick">*(a+n)</tt> is that it doesn't actually matter which of the array name or the index goes inside the braces.  So all of <tt class="backtick">a[0]</tt>, <tt class="backtick">*a</tt>, and <tt class="backtick">0[a]</tt> refer to the zeroth entry in <tt class="backtick">a</tt>.  Unless you are deliberately trying to obfuscate your code, it's best to write what you mean. <span class="anchor" id="line-200"></span><span class="anchor" id="line-201"></span></p><p class="line867">
</p><h2 id="Arrays_and_functions">5.1. Arrays and functions</h2>
<span class="anchor" id="line-202"></span><span class="anchor" id="line-203"></span><p class="line862">Because
 array names act like pointers, they can be passed into functions that 
expect pointers as their arguments.  For example, here is a function 
that computes the sum of all the values in an array <tt class="backtick">a</tt> of size <tt class="backtick">n</tt>: <span class="anchor" id="line-204"></span><span class="anchor" id="line-205"></span></p><p class="line867"><span class="anchor" id="line-206"></span><span class="anchor" id="line-207"></span><span class="anchor" id="line-208"></span><span class="anchor" id="line-209"></span><span class="anchor" id="line-210"></span><span class="anchor" id="line-211"></span><span class="anchor" id="line-212"></span><span class="anchor" id="line-213"></span><span class="anchor" id="line-214"></span><span class="anchor" id="line-215"></span><span class="anchor" id="line-216"></span><span class="anchor" id="line-217"></span><span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><span class="anchor" id="line-220"></span><span class="anchor" id="line-1-31"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-5a35893a831a41578b94561670a3c3d0dc112e5a\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-5a35893a831a41578b94561670a3c3d0dc112e5a', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-5a35893a831a41578b94561670a3c3d0dc112e5a" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-5a35893a831a41578b94561670a3c3d0dc112e5a_1">   1</a> </span><span class="LineAnchor" id="CA-5a35893a831a41578b94561670a3c3d0dc112e5a_1"></span><span class="anchor" id="line-1-32"></span><span class="Comment">/* return the sum of the values in a, an array of size n */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5a35893a831a41578b94561670a3c3d0dc112e5a_2">   2</a> </span><span class="LineAnchor" id="CA-5a35893a831a41578b94561670a3c3d0dc112e5a_2"></span><span class="anchor" id="line-2-16"></span><span class="ResWord">int</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5a35893a831a41578b94561670a3c3d0dc112e5a_3">   3</a> </span><span class="LineAnchor" id="CA-5a35893a831a41578b94561670a3c3d0dc112e5a_3"></span><span class="anchor" id="line-3-14"></span><span class="ID">sumArray</span>(<span class="ResWord">int</span> <span class="ID">in</span>, <span class="ResWord">const</span> <span class="ResWord">int</span> *<span class="ID">a</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a35893a831a41578b94561670a3c3d0dc112e5a_4">   4</a> </span><span class="LineAnchor" id="CA-5a35893a831a41578b94561670a3c3d0dc112e5a_4"></span><span class="anchor" id="line-4-13"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a35893a831a41578b94561670a3c3d0dc112e5a_5">   5</a> </span><span class="LineAnchor" id="CA-5a35893a831a41578b94561670a3c3d0dc112e5a_5"></span><span class="anchor" id="line-5-11"></span>    <span class="ResWord">int</span> <span class="ID">i</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a35893a831a41578b94561670a3c3d0dc112e5a_6">   6</a> </span><span class="LineAnchor" id="CA-5a35893a831a41578b94561670a3c3d0dc112e5a_6"></span><span class="anchor" id="line-6-10"></span>    <span class="ResWord">int</span> <span class="ID">sum</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a35893a831a41578b94561670a3c3d0dc112e5a_7">   7</a> </span><span class="LineAnchor" id="CA-5a35893a831a41578b94561670a3c3d0dc112e5a_7"></span><span class="anchor" id="line-7-7"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5a35893a831a41578b94561670a3c3d0dc112e5a_8">   8</a> </span><span class="LineAnchor" id="CA-5a35893a831a41578b94561670a3c3d0dc112e5a_8"></span><span class="anchor" id="line-8-6"></span>    <span class="ID">sum</span> = <span class="Number">0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a35893a831a41578b94561670a3c3d0dc112e5a_9">   9</a> </span><span class="LineAnchor" id="CA-5a35893a831a41578b94561670a3c3d0dc112e5a_9"></span><span class="anchor" id="line-9-6"></span>    <span class="ResWord">for</span>(<span class="ID">i</span> = <span class="Number">0</span>; <span class="ID">i</span> &lt; <span class="ID">n</span>; <span class="ID">i</span>++) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a35893a831a41578b94561670a3c3d0dc112e5a_10">  10</a> </span><span class="LineAnchor" id="CA-5a35893a831a41578b94561670a3c3d0dc112e5a_10"></span><span class="anchor" id="line-10-6"></span>        <span class="ID">sum</span> += <span class="ID">a</span>[<span class="ID">i</span>];</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a35893a831a41578b94561670a3c3d0dc112e5a_11">  11</a> </span><span class="LineAnchor" id="CA-5a35893a831a41578b94561670a3c3d0dc112e5a_11"></span><span class="anchor" id="line-11-6"></span>    }</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a35893a831a41578b94561670a3c3d0dc112e5a_12">  12</a> </span><span class="LineAnchor" id="CA-5a35893a831a41578b94561670a3c3d0dc112e5a_12"></span><span class="anchor" id="line-12-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5a35893a831a41578b94561670a3c3d0dc112e5a_13">  13</a> </span><span class="LineAnchor" id="CA-5a35893a831a41578b94561670a3c3d0dc112e5a_13"></span><span class="anchor" id="line-13-4"></span>    <span class="ResWord">return</span> <span class="ID">sum</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a35893a831a41578b94561670a3c3d0dc112e5a_14">  14</a> </span><span class="LineAnchor" id="CA-5a35893a831a41578b94561670a3c3d0dc112e5a_14"></span><span class="anchor" id="line-14-4"></span>}</span>
</pre></div></div><span class="anchor" id="line-221"></span><span class="anchor" id="line-222"></span><p class="line862">Note the use of <tt class="backtick">const</tt> to promise that <tt class="backtick">sumArray</tt> won't modify the contents of <tt class="backtick">a</tt>. <span class="anchor" id="line-223"></span><span class="anchor" id="line-224"></span></p><p class="line862">Another way to write the function header is to declare <tt class="backtick">a</tt> as an array of unknown size: <span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span></p><p class="line867"><span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span><span class="anchor" id="line-229"></span><span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span><span class="anchor" id="line-232"></span><span class="anchor" id="line-233"></span><span class="anchor" id="line-1-33"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-cc276e3bccf20df8e5267977bd8dc48839798cd3\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-cc276e3bccf20df8e5267977bd8dc48839798cd3', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-cc276e3bccf20df8e5267977bd8dc48839798cd3" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-cc276e3bccf20df8e5267977bd8dc48839798cd3_1">   1</a> </span><span class="LineAnchor" id="CA-cc276e3bccf20df8e5267977bd8dc48839798cd3_1"></span><span class="anchor" id="line-1-34"></span><span class="Comment">/* return the sum of the values in a, an array of size n */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-cc276e3bccf20df8e5267977bd8dc48839798cd3_2">   2</a> </span><span class="LineAnchor" id="CA-cc276e3bccf20df8e5267977bd8dc48839798cd3_2"></span><span class="anchor" id="line-2-17"></span><span class="ResWord">int</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-cc276e3bccf20df8e5267977bd8dc48839798cd3_3">   3</a> </span><span class="LineAnchor" id="CA-cc276e3bccf20df8e5267977bd8dc48839798cd3_3"></span><span class="anchor" id="line-3-15"></span><span class="ID">sumArray</span>(<span class="ResWord">int</span> <span class="ID">n</span>, <span class="ResWord">const</span> <span class="ResWord">int</span> <span class="ID">a</span>[])</span>
<span class="line"><span class="LineNumber"><a href="#CA-cc276e3bccf20df8e5267977bd8dc48839798cd3_4">   4</a> </span><span class="LineAnchor" id="CA-cc276e3bccf20df8e5267977bd8dc48839798cd3_4"></span><span class="anchor" id="line-4-14"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-cc276e3bccf20df8e5267977bd8dc48839798cd3_5">   5</a> </span><span class="LineAnchor" id="CA-cc276e3bccf20df8e5267977bd8dc48839798cd3_5"></span><span class="anchor" id="line-5-12"></span>    ...</span>
<span class="line"><span class="LineNumber"><a href="#CA-cc276e3bccf20df8e5267977bd8dc48839798cd3_6">   6</a> </span><span class="LineAnchor" id="CA-cc276e3bccf20df8e5267977bd8dc48839798cd3_6"></span><span class="anchor" id="line-6-11"></span>}</span>
</pre></div></div><span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span><p class="line862">This has <em>exactly</em> the same meaning to the compiler as the previous definition.  Even though normally the declarations <tt class="backtick">int&nbsp;a[10]</tt> and <tt class="backtick">int&nbsp;*a</tt> mean very different things (the first one allocates space to hold 10 <tt class="backtick">int</tt>s, and prevents assigning a new value to <tt class="backtick">a</tt>), in a function argument <tt class="backtick">int&nbsp;a[]</tt> is just <a href="http://www.cs.yale.edu/homes/aspnes/pinewiki/SyntacticSugar.html">SyntacticSugar</a> for <tt class="backtick">int&nbsp;*a</tt>.  You can even modify what <tt class="backtick">a</tt> points to inside <tt class="backtick">sumArray</tt> by assigning to it.  This will allow you to do things that you usually don't want to do, like write this hideous routine: <span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span></p><p class="line867"><span class="anchor" id="line-238"></span><span class="anchor" id="line-239"></span><span class="anchor" id="line-240"></span><span class="anchor" id="line-241"></span><span class="anchor" id="line-242"></span><span class="anchor" id="line-243"></span><span class="anchor" id="line-244"></span><span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span><span class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span><span class="anchor" id="line-249"></span><span class="anchor" id="line-250"></span><span class="anchor" id="line-251"></span><span class="anchor" id="line-252"></span><span class="anchor" id="line-253"></span><span class="anchor" id="line-254"></span><span class="anchor" id="line-1-35"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-683335229c229bfd48431908bf27848d69e9393e\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-683335229c229bfd48431908bf27848d69e9393e', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-683335229c229bfd48431908bf27848d69e9393e" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-683335229c229bfd48431908bf27848d69e9393e_1">   1</a> </span><span class="LineAnchor" id="CA-683335229c229bfd48431908bf27848d69e9393e_1"></span><span class="anchor" id="line-1-36"></span><span class="Comment">/* return the sum of the values in a, an array of size n */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-683335229c229bfd48431908bf27848d69e9393e_2">   2</a> </span><span class="LineAnchor" id="CA-683335229c229bfd48431908bf27848d69e9393e_2"></span><span class="anchor" id="line-2-18"></span><span class="ResWord">int</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-683335229c229bfd48431908bf27848d69e9393e_3">   3</a> </span><span class="LineAnchor" id="CA-683335229c229bfd48431908bf27848d69e9393e_3"></span><span class="anchor" id="line-3-16"></span><span class="ID">sumArray</span>(<span class="ResWord">int</span> <span class="ID">n</span>, <span class="ResWord">const</span> <span class="ResWord">int</span> <span class="ID">a</span>[])</span>
<span class="line"><span class="LineNumber"><a href="#CA-683335229c229bfd48431908bf27848d69e9393e_4">   4</a> </span><span class="LineAnchor" id="CA-683335229c229bfd48431908bf27848d69e9393e_4"></span><span class="anchor" id="line-4-15"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-683335229c229bfd48431908bf27848d69e9393e_5">   5</a> </span><span class="LineAnchor" id="CA-683335229c229bfd48431908bf27848d69e9393e_5"></span><span class="anchor" id="line-5-13"></span>    <span class="ResWord">const</span> <span class="ResWord">int</span> *<span class="ID">an</span>;      <span class="Comment">/* pointer to first element not in a */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-683335229c229bfd48431908bf27848d69e9393e_6">   6</a> </span><span class="LineAnchor" id="CA-683335229c229bfd48431908bf27848d69e9393e_6"></span><span class="anchor" id="line-6-12"></span>    <span class="ResWord">int</span> <span class="ID">sum</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-683335229c229bfd48431908bf27848d69e9393e_7">   7</a> </span><span class="LineAnchor" id="CA-683335229c229bfd48431908bf27848d69e9393e_7"></span><span class="anchor" id="line-7-8"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-683335229c229bfd48431908bf27848d69e9393e_8">   8</a> </span><span class="LineAnchor" id="CA-683335229c229bfd48431908bf27848d69e9393e_8"></span><span class="anchor" id="line-8-7"></span>    <span class="ID">sum</span> = <span class="Number">0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-683335229c229bfd48431908bf27848d69e9393e_9">   9</a> </span><span class="LineAnchor" id="CA-683335229c229bfd48431908bf27848d69e9393e_9"></span><span class="anchor" id="line-9-7"></span>    <span class="ID">an</span> = <span class="ID">a</span>+<span class="ID">n</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-683335229c229bfd48431908bf27848d69e9393e_10">  10</a> </span><span class="LineAnchor" id="CA-683335229c229bfd48431908bf27848d69e9393e_10"></span><span class="anchor" id="line-10-7"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-683335229c229bfd48431908bf27848d69e9393e_11">  11</a> </span><span class="LineAnchor" id="CA-683335229c229bfd48431908bf27848d69e9393e_11"></span><span class="anchor" id="line-11-7"></span>    <span class="ResWord">while</span>(<span class="ID">a</span> &lt; <span class="ID">an</span>) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-683335229c229bfd48431908bf27848d69e9393e_12">  12</a> </span><span class="LineAnchor" id="CA-683335229c229bfd48431908bf27848d69e9393e_12"></span><span class="anchor" id="line-12-5"></span>        <span class="ID">sum</span> += *<span class="ID">a</span>++;</span>
<span class="line"><span class="LineNumber"><a href="#CA-683335229c229bfd48431908bf27848d69e9393e_13">  13</a> </span><span class="LineAnchor" id="CA-683335229c229bfd48431908bf27848d69e9393e_13"></span><span class="anchor" id="line-13-5"></span>    }</span>
<span class="line"><span class="LineNumber"><a href="#CA-683335229c229bfd48431908bf27848d69e9393e_14">  14</a> </span><span class="LineAnchor" id="CA-683335229c229bfd48431908bf27848d69e9393e_14"></span><span class="anchor" id="line-14-5"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-683335229c229bfd48431908bf27848d69e9393e_15">  15</a> </span><span class="LineAnchor" id="CA-683335229c229bfd48431908bf27848d69e9393e_15"></span><span class="anchor" id="line-15-4"></span>    <span class="ResWord">return</span> <span class="ID">sum</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-683335229c229bfd48431908bf27848d69e9393e_16">  16</a> </span><span class="LineAnchor" id="CA-683335229c229bfd48431908bf27848d69e9393e_16"></span><span class="anchor" id="line-16-4"></span>}</span>
</pre></div></div><span class="anchor" id="line-255"></span><span class="anchor" id="line-256"></span><p class="line867">
</p><h2 id="Multidimensional_arrays">5.2. Multidimensional arrays</h2>
<span class="anchor" id="line-257"></span><span class="anchor" id="line-258"></span><p class="line862">Arrays can themselves be members of arrays.  The result is a multidimensional array, where a value in row <tt class="backtick">i</tt> and column <tt class="backtick">j</tt> is accessed by <tt class="backtick">a[i][j]</tt>. <span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span></p><p class="line874">Declaration is similar to one-dimensional arrays: <span class="anchor" id="line-261"></span><span class="anchor" id="line-262"></span></p><p class="line867"><span class="anchor" id="line-263"></span><span class="anchor" id="line-264"></span><span class="anchor" id="line-1-37"></span></p><div class="highlight c"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-208d4aa70277a7eb6c7962021daf49e58c6b8940\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-208d4aa70277a7eb6c7962021daf49e58c6b8940', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-208d4aa70277a7eb6c7962021daf49e58c6b8940" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-208d4aa70277a7eb6c7962021daf49e58c6b8940_1">   1</a> </span><span class="LineAnchor" id="CA-208d4aa70277a7eb6c7962021daf49e58c6b8940_1"></span><span class="anchor" id="line-1-38"></span><span class="ResWord">int</span> <span class="ID">a</span>[<span class="Number">6</span>][<span class="Number">4</span>];    <span class="Comment">/* declares an array of 6 rows of 4 ints each */</span></span>
</pre></div></div><span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><p class="line862">This declaration produces an array of 24 <tt class="backtick">int</tt> values, packed contiguously in memory.  The interpretation is that <tt class="backtick">a</tt> is an array of 6 objects, each of which is an array of 4 <tt class="backtick">int</tt>s. <span class="anchor" id="line-267"></span><span class="anchor" id="line-268"></span></p><p class="line874">If we imagine the array to contain increasing values like this: <span class="anchor" id="line-269"></span><span class="anchor" id="line-270"></span><span class="anchor" id="line-271"></span><span class="anchor" id="line-272"></span><span class="anchor" id="line-273"></span></p><pre><span class="anchor" id="line-1-1"></span> 0  1  2  3  4  5
<span class="anchor" id="line-2-1"></span> 6  7  8  9 10 11
<span class="anchor" id="line-3-1"></span>12 13 14 15 16 17</pre><span class="anchor" id="line-274"></span><p class="line874">the actual positions in memory will look like this: <span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span><span class="anchor" id="line-277"></span><span class="anchor" id="line-278"></span><span class="anchor" id="line-279"></span></p><pre><span class="anchor" id="line-1-2"></span> 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17
<span class="anchor" id="line-2-2"></span> ^                 ^                 ^
<span class="anchor" id="line-3-2"></span>a[0]              a[1]              a[2]</pre><span class="anchor" id="line-280"></span><span class="anchor" id="line-281"></span><p class="line862">To look up a value, we do the usual array-indexing magic.  Suppose we want to find <tt class="backtick">a[1][4]</tt>.  The name <tt class="backtick">a</tt> acts as a pointer to the base of the array.The name <tt class="backtick">a[1]</tt> says to skip ahead 1 times the size of the things pointed to by <tt class="backtick">a</tt>, which are arrays of 6 <tt class="backtick">int</tt>s each, for a total size of 24 bytes assuming 4-byte <tt class="backtick">int</tt>s.  For <tt class="backtick">a[1][4]</tt>, we start at <tt class="backtick">a[1]</tt> and move forward 4 times the size of the thing pointed to by <tt class="backtick">a[1]</tt>, which is an <tt class="backtick">int</tt>; this puts us 24+16 bytes from <tt class="backtick">a</tt>, the position of 10 in the picture above. <span class="anchor" id="line-282"></span><span class="anchor" id="line-283"></span></p><p class="line862">Like other array declarations, the size must be specified at compile time in pre-<a href="http://www.cs.yale.edu/homes/aspnes/pinewiki/C99.html">C99</a> C.  If this is not desirable, a similar effect can be obtained by allocating each row separately using <tt class="backtick">malloc</tt> and building a master list of pointers to rows, of type <tt class="backtick">int&nbsp;**</tt>.
  The downside of this approach is that the array is no longer 
contiguous (which may affect cache performance) and it requires reading a
 pointer to find the location of a particular value, instead of just 
doing address arithmetic starting from the base address of the array.  
But elements can still be accessed using the <tt class="backtick">a[i][j]</tt> syntax.  An example of this approach is given in <a class="attachment" href="http://www.cs.yale.edu/homes/aspnes/pinewiki/attachments/C%282f%29Pointers/malloc2d.c" title="">malloc2d.c</a>. <span class="anchor" id="line-284"></span><span class="anchor" id="line-285"></span></p><p class="line867">
</p><h2 id="Variable-length_arrays">5.3. Variable-length arrays</h2>
<span class="anchor" id="line-286"></span><span class="anchor" id="line-287"></span><p class="line867"><a href="http://www.cs.yale.edu/homes/aspnes/pinewiki/C99.html">C99</a> adds the feature of <strong>variable-length arrays</strong>, where the size of the array is determined at run-time.  These can only appear as local variables in procedures (<em>automatic variables</em>)
 or in argument lists.  In the case of variable-length arrays in 
argument lists, it is also necessary that the length of the array be 
computable from previous arguments. <span class="anchor" id="line-288"></span><span class="anchor" id="line-289"></span></p><p class="line862">For example, we could make the length of the array explicit in our <tt class="backtick">sumArray</tt> function: <span class="anchor" id="line-290"></span><span class="anchor" id="line-291"></span></p><p class="line867"><span class="anchor" id="line-292"></span><span class="anchor" id="line-293"></span><span class="anchor" id="line-294"></span><span class="anchor" id="line-295"></span><span class="anchor" id="line-296"></span><span class="anchor" id="line-297"></span><span class="anchor" id="line-298"></span><span class="anchor" id="line-299"></span><span class="anchor" id="line-300"></span><span class="anchor" id="line-301"></span><span class="anchor" id="line-302"></span><span class="anchor" id="line-303"></span><span class="anchor" id="line-304"></span><span class="anchor" id="line-305"></span><span class="anchor" id="line-306"></span><span class="anchor" id="line-1-39"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_1">   1</a> </span><span class="LineAnchor" id="CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_1"></span><span class="anchor" id="line-1-40"></span><span class="Comment">/* return the sum of the values in a, an array of size n */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_2">   2</a> </span><span class="LineAnchor" id="CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_2"></span><span class="anchor" id="line-2-19"></span><span class="ResWord">int</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_3">   3</a> </span><span class="LineAnchor" id="CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_3"></span><span class="anchor" id="line-3-17"></span><span class="ID">sumArray</span>(<span class="ResWord">int</span> <span class="ID">n</span>, <span class="ResWord">const</span> <span class="ResWord">int</span> <span class="ID">a</span>[<span class="ID">n</span>])</span>
<span class="line"><span class="LineNumber"><a href="#CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_4">   4</a> </span><span class="LineAnchor" id="CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_4"></span><span class="anchor" id="line-4-16"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_5">   5</a> </span><span class="LineAnchor" id="CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_5"></span><span class="anchor" id="line-5-14"></span>    <span class="ResWord">int</span> <span class="ID">i</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_6">   6</a> </span><span class="LineAnchor" id="CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_6"></span><span class="anchor" id="line-6-13"></span>    <span class="ResWord">int</span> <span class="ID">sum</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_7">   7</a> </span><span class="LineAnchor" id="CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_7"></span><span class="anchor" id="line-7-9"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_8">   8</a> </span><span class="LineAnchor" id="CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_8"></span><span class="anchor" id="line-8-8"></span>    <span class="ID">sum</span> = <span class="Number">0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_9">   9</a> </span><span class="LineAnchor" id="CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_9"></span><span class="anchor" id="line-9-8"></span>    <span class="ResWord">for</span>(<span class="ID">i</span> = <span class="Number">0</span>; <span class="ID">i</span> &lt; <span class="ID">n</span>; <span class="ID">i</span>++) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_10">  10</a> </span><span class="LineAnchor" id="CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_10"></span><span class="anchor" id="line-10-8"></span>        <span class="ID">sum</span> += <span class="ID">a</span>[<span class="ID">i</span>];</span>
<span class="line"><span class="LineNumber"><a href="#CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_11">  11</a> </span><span class="LineAnchor" id="CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_11"></span><span class="anchor" id="line-11-8"></span>    }</span>
<span class="line"><span class="LineNumber"><a href="#CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_12">  12</a> </span><span class="LineAnchor" id="CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_12"></span><span class="anchor" id="line-12-6"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_13">  13</a> </span><span class="LineAnchor" id="CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_13"></span><span class="anchor" id="line-13-6"></span>    <span class="ResWord">return</span> <span class="ID">sum</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_14">  14</a> </span><span class="LineAnchor" id="CA-f8d8f19c7a2f62d240dd265e189974d06247e6f3_14"></span><span class="anchor" id="line-14-6"></span>}</span>
</pre></div></div><span class="anchor" id="line-307"></span><span class="anchor" id="line-308"></span><p class="line874">This
 doesn't accompish much, because the length of the array is not used.  
However, it does become useful if we have a two-dimensional array, as 
otherwise there is no way to compute the length of each row: <span class="anchor" id="line-309"></span><span class="anchor" id="line-310"></span></p><p class="line867"><span class="anchor" id="line-311"></span><span class="anchor" id="line-312"></span><span class="anchor" id="line-313"></span><span class="anchor" id="line-314"></span><span class="anchor" id="line-315"></span><span class="anchor" id="line-316"></span><span class="anchor" id="line-317"></span><span class="anchor" id="line-318"></span><span class="anchor" id="line-319"></span><span class="anchor" id="line-320"></span><span class="anchor" id="line-321"></span><span class="anchor" id="line-322"></span><span class="anchor" id="line-323"></span><span class="anchor" id="line-324"></span><span class="anchor" id="line-325"></span><span class="anchor" id="line-326"></span><span class="anchor" id="line-327"></span><span class="anchor" id="line-1-41"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-defc7cc00acc2d26f45256b8290783ff708d1a48\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-defc7cc00acc2d26f45256b8290783ff708d1a48', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-defc7cc00acc2d26f45256b8290783ff708d1a48" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-defc7cc00acc2d26f45256b8290783ff708d1a48_1">   1</a> </span><span class="LineAnchor" id="CA-defc7cc00acc2d26f45256b8290783ff708d1a48_1"></span><span class="anchor" id="line-1-42"></span><span class="ResWord">int</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-defc7cc00acc2d26f45256b8290783ff708d1a48_2">   2</a> </span><span class="LineAnchor" id="CA-defc7cc00acc2d26f45256b8290783ff708d1a48_2"></span><span class="anchor" id="line-2-20"></span><span class="ID">sumMatrix</span>(<span class="ResWord">int</span> <span class="ID">rows</span>, <span class="ResWord">int</span> <span class="ID">cols</span>, <span class="ResWord">const</span> <span class="ResWord">int</span> <span class="ID">m</span>[<span class="ID">rows</span>][<span class="ID">cols</span>])</span>
<span class="line"><span class="LineNumber"><a href="#CA-defc7cc00acc2d26f45256b8290783ff708d1a48_3">   3</a> </span><span class="LineAnchor" id="CA-defc7cc00acc2d26f45256b8290783ff708d1a48_3"></span><span class="anchor" id="line-3-18"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-defc7cc00acc2d26f45256b8290783ff708d1a48_4">   4</a> </span><span class="LineAnchor" id="CA-defc7cc00acc2d26f45256b8290783ff708d1a48_4"></span><span class="anchor" id="line-4-17"></span>    <span class="ResWord">int</span> <span class="ID">i</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-defc7cc00acc2d26f45256b8290783ff708d1a48_5">   5</a> </span><span class="LineAnchor" id="CA-defc7cc00acc2d26f45256b8290783ff708d1a48_5"></span><span class="anchor" id="line-5-15"></span>    <span class="ResWord">int</span> <span class="ID">j</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-defc7cc00acc2d26f45256b8290783ff708d1a48_6">   6</a> </span><span class="LineAnchor" id="CA-defc7cc00acc2d26f45256b8290783ff708d1a48_6"></span><span class="anchor" id="line-6-14"></span>    <span class="ResWord">int</span> <span class="ID">sum</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-defc7cc00acc2d26f45256b8290783ff708d1a48_7">   7</a> </span><span class="LineAnchor" id="CA-defc7cc00acc2d26f45256b8290783ff708d1a48_7"></span><span class="anchor" id="line-7-10"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-defc7cc00acc2d26f45256b8290783ff708d1a48_8">   8</a> </span><span class="LineAnchor" id="CA-defc7cc00acc2d26f45256b8290783ff708d1a48_8"></span><span class="anchor" id="line-8-9"></span>    <span class="ID">sum</span> = <span class="Number">0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-defc7cc00acc2d26f45256b8290783ff708d1a48_9">   9</a> </span><span class="LineAnchor" id="CA-defc7cc00acc2d26f45256b8290783ff708d1a48_9"></span><span class="anchor" id="line-9-9"></span>    <span class="ResWord">for</span>(<span class="ID">i</span> = <span class="Number">0</span>; <span class="ID">i</span> &lt; <span class="ID">rows</span>; <span class="ID">i</span>++) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-defc7cc00acc2d26f45256b8290783ff708d1a48_10">  10</a> </span><span class="LineAnchor" id="CA-defc7cc00acc2d26f45256b8290783ff708d1a48_10"></span><span class="anchor" id="line-10-9"></span>        <span class="ResWord">for</span>(<span class="ID">j</span> = <span class="Number">0</span>; <span class="ID">j</span> &lt; <span class="ID">cols</span>; <span class="ID">j</span>++) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-defc7cc00acc2d26f45256b8290783ff708d1a48_11">  11</a> </span><span class="LineAnchor" id="CA-defc7cc00acc2d26f45256b8290783ff708d1a48_11"></span><span class="anchor" id="line-11-9"></span>            <span class="ID">sum</span> += <span class="ID">a</span>[<span class="ID">i</span>][<span class="ID">j</span>];</span>
<span class="line"><span class="LineNumber"><a href="#CA-defc7cc00acc2d26f45256b8290783ff708d1a48_12">  12</a> </span><span class="LineAnchor" id="CA-defc7cc00acc2d26f45256b8290783ff708d1a48_12"></span><span class="anchor" id="line-12-7"></span>        }</span>
<span class="line"><span class="LineNumber"><a href="#CA-defc7cc00acc2d26f45256b8290783ff708d1a48_13">  13</a> </span><span class="LineAnchor" id="CA-defc7cc00acc2d26f45256b8290783ff708d1a48_13"></span><span class="anchor" id="line-13-7"></span>    }</span>
<span class="line"><span class="LineNumber"><a href="#CA-defc7cc00acc2d26f45256b8290783ff708d1a48_14">  14</a> </span><span class="LineAnchor" id="CA-defc7cc00acc2d26f45256b8290783ff708d1a48_14"></span><span class="anchor" id="line-14-7"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-defc7cc00acc2d26f45256b8290783ff708d1a48_15">  15</a> </span><span class="LineAnchor" id="CA-defc7cc00acc2d26f45256b8290783ff708d1a48_15"></span><span class="anchor" id="line-15-5"></span>    <span class="ResWord">return</span> <span class="ID">sum</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-defc7cc00acc2d26f45256b8290783ff708d1a48_16">  16</a> </span><span class="LineAnchor" id="CA-defc7cc00acc2d26f45256b8290783ff708d1a48_16"></span><span class="anchor" id="line-16-5"></span>}</span>
</pre></div></div><span class="anchor" id="line-328"></span><span class="anchor" id="line-329"></span><p class="line862">Here the fact that each row of <tt class="backtick">m</tt> is known to be an array of <tt class="backtick">cols</tt> many <tt class="backtick">int</tt>s makes the implicit pointer computation in <tt class="backtick">a[i][j]</tt> actually work.  It is considerably more difficult to to this in ANSI C; the simplest approach is to pack <tt class="backtick">m</tt> into a one-dimensional array and do the address computation explicitly: <span class="anchor" id="line-330"></span><span class="anchor" id="line-331"></span></p><p class="line867"><span class="anchor" id="line-332"></span><span class="anchor" id="line-333"></span><span class="anchor" id="line-334"></span><span class="anchor" id="line-335"></span><span class="anchor" id="line-336"></span><span class="anchor" id="line-337"></span><span class="anchor" id="line-338"></span><span class="anchor" id="line-339"></span><span class="anchor" id="line-340"></span><span class="anchor" id="line-341"></span><span class="anchor" id="line-342"></span><span class="anchor" id="line-343"></span><span class="anchor" id="line-344"></span><span class="anchor" id="line-345"></span><span class="anchor" id="line-346"></span><span class="anchor" id="line-347"></span><span class="anchor" id="line-348"></span><span class="anchor" id="line-1-43"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_1">   1</a> </span><span class="LineAnchor" id="CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_1"></span><span class="anchor" id="line-1-44"></span><span class="ResWord">int</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_2">   2</a> </span><span class="LineAnchor" id="CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_2"></span><span class="anchor" id="line-2-21"></span><span class="ID">sumMatrix</span>(<span class="ResWord">int</span> <span class="ID">rows</span>, <span class="ResWord">int</span> <span class="ID">cols</span>, <span class="ResWord">const</span> <span class="ResWord">int</span> <span class="ID">a</span>[])</span>
<span class="line"><span class="LineNumber"><a href="#CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_3">   3</a> </span><span class="LineAnchor" id="CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_3"></span><span class="anchor" id="line-3-19"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_4">   4</a> </span><span class="LineAnchor" id="CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_4"></span><span class="anchor" id="line-4-18"></span>    <span class="ResWord">int</span> <span class="ID">i</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_5">   5</a> </span><span class="LineAnchor" id="CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_5"></span><span class="anchor" id="line-5-16"></span>    <span class="ResWord">int</span> <span class="ID">j</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_6">   6</a> </span><span class="LineAnchor" id="CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_6"></span><span class="anchor" id="line-6-15"></span>    <span class="ResWord">int</span> <span class="ID">sum</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_7">   7</a> </span><span class="LineAnchor" id="CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_7"></span><span class="anchor" id="line-7-11"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_8">   8</a> </span><span class="LineAnchor" id="CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_8"></span><span class="anchor" id="line-8-10"></span>    <span class="ID">sum</span> = <span class="Number">0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_9">   9</a> </span><span class="LineAnchor" id="CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_9"></span><span class="anchor" id="line-9-10"></span>    <span class="ResWord">for</span>(<span class="ID">i</span> = <span class="Number">0</span>; <span class="ID">i</span> &lt; <span class="ID">rows</span>; <span class="ID">i</span>++) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_10">  10</a> </span><span class="LineAnchor" id="CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_10"></span><span class="anchor" id="line-10-10"></span>        <span class="ResWord">for</span>(<span class="ID">j</span> = <span class="Number">0</span>; <span class="ID">j</span> &lt; <span class="ID">cols</span>; <span class="ID">j</span>++) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_11">  11</a> </span><span class="LineAnchor" id="CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_11"></span><span class="anchor" id="line-11-10"></span>            <span class="ID">sum</span> += <span class="ID">a</span>[<span class="ID">i</span>*<span class="ID">cols</span> + <span class="ID">j</span>];</span>
<span class="line"><span class="LineNumber"><a href="#CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_12">  12</a> </span><span class="LineAnchor" id="CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_12"></span><span class="anchor" id="line-12-8"></span>        }</span>
<span class="line"><span class="LineNumber"><a href="#CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_13">  13</a> </span><span class="LineAnchor" id="CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_13"></span><span class="anchor" id="line-13-8"></span>    }</span>
<span class="line"><span class="LineNumber"><a href="#CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_14">  14</a> </span><span class="LineAnchor" id="CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_14"></span><span class="anchor" id="line-14-8"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_15">  15</a> </span><span class="LineAnchor" id="CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_15"></span><span class="anchor" id="line-15-6"></span>    <span class="ResWord">return</span> <span class="ID">sum</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_16">  16</a> </span><span class="LineAnchor" id="CA-f4229e6b543dee03dd8143465ef5e7a1cb9dcdef_16"></span><span class="anchor" id="line-16-6"></span>}</span>
</pre></div></div><span class="anchor" id="line-349"></span><span class="anchor" id="line-350"></span><p class="line862">Variable-length arrays can sometimes be used for run-time storage allocation, as an alternative to <tt class="backtick">malloc</tt> and <tt class="backtick">free</tt>
 (see below).  A variable-length array allocated as a local variable 
will be deallocated when the containing scope (usually a function body, 
but maybe just a compound statement marked off by braces) exits.  One 
consequence of this is that you can't return a variable-length array 
from a function. <span class="anchor" id="line-351"></span><span class="anchor" id="line-352"></span></p><p class="line874">Here is an example of code using this feature: <span class="anchor" id="line-353"></span><span class="anchor" id="line-354"></span></p><p class="line867"><span class="anchor" id="line-355"></span><span class="anchor" id="line-356"></span><span class="anchor" id="line-357"></span><span class="anchor" id="line-358"></span><span class="anchor" id="line-359"></span><span class="anchor" id="line-360"></span><span class="anchor" id="line-361"></span><span class="anchor" id="line-362"></span><span class="anchor" id="line-363"></span><span class="anchor" id="line-364"></span><span class="anchor" id="line-365"></span><span class="anchor" id="line-366"></span><span class="anchor" id="line-367"></span><span class="anchor" id="line-368"></span><span class="anchor" id="line-369"></span><span class="anchor" id="line-370"></span><span class="anchor" id="line-371"></span><span class="anchor" id="line-372"></span><span class="anchor" id="line-373"></span><span class="anchor" id="line-374"></span><span class="anchor" id="line-1-45"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-eda227ba5c12849550e60ee139981bb9a7c116ca\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-eda227ba5c12849550e60ee139981bb9a7c116ca', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-eda227ba5c12849550e60ee139981bb9a7c116ca" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-eda227ba5c12849550e60ee139981bb9a7c116ca_1">   1</a> </span><span class="LineAnchor" id="CA-eda227ba5c12849550e60ee139981bb9a7c116ca_1"></span><span class="anchor" id="line-1-46"></span><span class="Comment">/* reverse an array in place */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-eda227ba5c12849550e60ee139981bb9a7c116ca_2">   2</a> </span><span class="LineAnchor" id="CA-eda227ba5c12849550e60ee139981bb9a7c116ca_2"></span><span class="anchor" id="line-2-22"></span><span class="ResWord">void</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-eda227ba5c12849550e60ee139981bb9a7c116ca_3">   3</a> </span><span class="LineAnchor" id="CA-eda227ba5c12849550e60ee139981bb9a7c116ca_3"></span><span class="anchor" id="line-3-20"></span><span class="ID">reverseArray</span>(<span class="ResWord">int</span> <span class="ID">n</span>, <span class="ResWord">int</span> <span class="ID">a</span>[<span class="ID">n</span>])</span>
<span class="line"><span class="LineNumber"><a href="#CA-eda227ba5c12849550e60ee139981bb9a7c116ca_4">   4</a> </span><span class="LineAnchor" id="CA-eda227ba5c12849550e60ee139981bb9a7c116ca_4"></span><span class="anchor" id="line-4-19"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-eda227ba5c12849550e60ee139981bb9a7c116ca_5">   5</a> </span><span class="LineAnchor" id="CA-eda227ba5c12849550e60ee139981bb9a7c116ca_5"></span><span class="anchor" id="line-5-17"></span>    <span class="Comment">/* algorithm: copy to a new array in reverse order */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-eda227ba5c12849550e60ee139981bb9a7c116ca_6">   6</a> </span><span class="LineAnchor" id="CA-eda227ba5c12849550e60ee139981bb9a7c116ca_6"></span><span class="anchor" id="line-6-16"></span>    <span class="Comment">/* then copy back */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-eda227ba5c12849550e60ee139981bb9a7c116ca_7">   7</a> </span><span class="LineAnchor" id="CA-eda227ba5c12849550e60ee139981bb9a7c116ca_7"></span><span class="anchor" id="line-7-12"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-eda227ba5c12849550e60ee139981bb9a7c116ca_8">   8</a> </span><span class="LineAnchor" id="CA-eda227ba5c12849550e60ee139981bb9a7c116ca_8"></span><span class="anchor" id="line-8-11"></span>    <span class="ResWord">int</span> <span class="ID">i</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-eda227ba5c12849550e60ee139981bb9a7c116ca_9">   9</a> </span><span class="LineAnchor" id="CA-eda227ba5c12849550e60ee139981bb9a7c116ca_9"></span><span class="anchor" id="line-9-11"></span>    <span class="ResWord">int</span> <span class="ID">copy</span>[<span class="ID">n</span>];</span>
<span class="line"><span class="LineNumber"><a href="#CA-eda227ba5c12849550e60ee139981bb9a7c116ca_10">  10</a> </span><span class="LineAnchor" id="CA-eda227ba5c12849550e60ee139981bb9a7c116ca_10"></span><span class="anchor" id="line-10-11"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-eda227ba5c12849550e60ee139981bb9a7c116ca_11">  11</a> </span><span class="LineAnchor" id="CA-eda227ba5c12849550e60ee139981bb9a7c116ca_11"></span><span class="anchor" id="line-11-11"></span>    <span class="ResWord">for</span>(<span class="ID">i</span> = <span class="Number">0</span>; <span class="ID">i</span> &lt; <span class="ID">n</span>; <span class="ID">i</span>++) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-eda227ba5c12849550e60ee139981bb9a7c116ca_12">  12</a> </span><span class="LineAnchor" id="CA-eda227ba5c12849550e60ee139981bb9a7c116ca_12"></span><span class="anchor" id="line-12-9"></span>        <span class="Comment">/* the -1 is needed to that a[0] goes to a[n-1] etc. */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-eda227ba5c12849550e60ee139981bb9a7c116ca_13">  13</a> </span><span class="LineAnchor" id="CA-eda227ba5c12849550e60ee139981bb9a7c116ca_13"></span><span class="anchor" id="line-13-9"></span>        <span class="ID">copy</span>[<span class="ID">n</span>-<span class="ID">i</span>-<span class="Number">1</span>] = <span class="ID">a</span>[<span class="ID">i</span>];</span>
<span class="line"><span class="LineNumber"><a href="#CA-eda227ba5c12849550e60ee139981bb9a7c116ca_14">  14</a> </span><span class="LineAnchor" id="CA-eda227ba5c12849550e60ee139981bb9a7c116ca_14"></span><span class="anchor" id="line-14-9"></span>    }</span>
<span class="line"><span class="LineNumber"><a href="#CA-eda227ba5c12849550e60ee139981bb9a7c116ca_15">  15</a> </span><span class="LineAnchor" id="CA-eda227ba5c12849550e60ee139981bb9a7c116ca_15"></span><span class="anchor" id="line-15-7"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-eda227ba5c12849550e60ee139981bb9a7c116ca_16">  16</a> </span><span class="LineAnchor" id="CA-eda227ba5c12849550e60ee139981bb9a7c116ca_16"></span><span class="anchor" id="line-16-7"></span>    <span class="ResWord">for</span>(<span class="ID">i</span> = <span class="Number">0</span>; <span class="ID">i</span> &lt; <span class="ID">n</span>; <span class="ID">i</span>++) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-eda227ba5c12849550e60ee139981bb9a7c116ca_17">  17</a> </span><span class="LineAnchor" id="CA-eda227ba5c12849550e60ee139981bb9a7c116ca_17"></span><span class="anchor" id="line-17-4"></span>        <span class="ID">a</span>[<span class="ID">i</span>] = <span class="ID">copy</span>[<span class="ID">i</span>];</span>
<span class="line"><span class="LineNumber"><a href="#CA-eda227ba5c12849550e60ee139981bb9a7c116ca_18">  18</a> </span><span class="LineAnchor" id="CA-eda227ba5c12849550e60ee139981bb9a7c116ca_18"></span><span class="anchor" id="line-18-4"></span>    }</span>
<span class="line"><span class="LineNumber"><a href="#CA-eda227ba5c12849550e60ee139981bb9a7c116ca_19">  19</a> </span><span class="LineAnchor" id="CA-eda227ba5c12849550e60ee139981bb9a7c116ca_19"></span><span class="anchor" id="line-19-4"></span>}</span>
</pre></div></div><span class="anchor" id="line-375"></span><span class="anchor" id="line-376"></span><p class="line862">While using variable-length arrays for this purpose can simplify code in some cases, as a general programming practice it is <strong>extremely dangerous</strong>.  The reason is that, unlike allocations through <tt class="backtick">malloc</tt>,
 variable-length array allocations are typically allocated on the stack 
(which is often more constrainted than the heap) and have no way of 
reporting failure.  So if there isn't enough room for your 
variable-length array, odds are you won't find out until a segmentation 
fault occurs somewhere later in your code when you try to use it. <span class="anchor" id="line-377"></span><span class="anchor" id="line-378"></span></p><p class="line862">(As an additional annoyance, <tt class="backtick">gdb</tt> is confused by two-dimensional variable-length arrays.) <span class="anchor" id="line-379"></span><span class="anchor" id="line-380"></span></p><p class="line862">Here's a safer version of the above routine, using <tt class="backtick">malloc</tt> and <tt class="backtick">free</tt>. <span class="anchor" id="line-381"></span><span class="anchor" id="line-382"></span></p><p class="line867"><span class="anchor" id="line-383"></span><span class="anchor" id="line-384"></span><span class="anchor" id="line-385"></span><span class="anchor" id="line-386"></span><span class="anchor" id="line-387"></span><span class="anchor" id="line-388"></span><span class="anchor" id="line-389"></span><span class="anchor" id="line-390"></span><span class="anchor" id="line-391"></span><span class="anchor" id="line-392"></span><span class="anchor" id="line-393"></span><span class="anchor" id="line-394"></span><span class="anchor" id="line-395"></span><span class="anchor" id="line-396"></span><span class="anchor" id="line-397"></span><span class="anchor" id="line-398"></span><span class="anchor" id="line-399"></span><span class="anchor" id="line-400"></span><span class="anchor" id="line-401"></span><span class="anchor" id="line-402"></span><span class="anchor" id="line-403"></span><span class="anchor" id="line-404"></span><span class="anchor" id="line-405"></span><span class="anchor" id="line-406"></span><span class="anchor" id="line-407"></span><span class="anchor" id="line-1-47"></span></p><div class="highlight c"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_1">   1</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_1"></span><span class="anchor" id="line-1-48"></span><span class="Comment">/* reverse an array in place */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_2">   2</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_2"></span><span class="anchor" id="line-2-23"></span><span class="ResWord">void</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_3">   3</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_3"></span><span class="anchor" id="line-3-21"></span><span class="ID">reverseArray</span>(<span class="ResWord">int</span> <span class="ID">n</span>, <span class="ResWord">int</span> <span class="ID">a</span>[<span class="ID">n</span>])</span>
<span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_4">   4</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_4"></span><span class="anchor" id="line-4-20"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_5">   5</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_5"></span><span class="anchor" id="line-5-18"></span>    <span class="Comment">/* algorithm: copy to a new array in reverse order */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_6">   6</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_6"></span><span class="anchor" id="line-6-17"></span>    <span class="Comment">/* then copy back */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_7">   7</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_7"></span><span class="anchor" id="line-7-13"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_8">   8</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_8"></span><span class="anchor" id="line-8-12"></span>    <span class="ResWord">int</span> <span class="ID">i</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_9">   9</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_9"></span><span class="anchor" id="line-9-12"></span>    <span class="ResWord">int</span> *<span class="ID">copy</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_10">  10</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_10"></span><span class="anchor" id="line-10-12"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_11">  11</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_11"></span><span class="anchor" id="line-11-12"></span>    <span class="ID">copy</span> = (<span class="ResWord">int</span> *) <span class="ID">malloc</span>(<span class="ID">n</span> * <span class="ResWord">sizeof</span>(<span class="ResWord">int</span>));</span>
<span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_12">  12</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_12"></span><span class="anchor" id="line-12-10"></span>    <span class="ID">assert</span>(<span class="ID">copy</span>);  <span class="Comment">/* or some other error check */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_13">  13</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_13"></span><span class="anchor" id="line-13-10"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_14">  14</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_14"></span><span class="anchor" id="line-14-10"></span>    <span class="ResWord">for</span>(<span class="ID">i</span> = <span class="Number">0</span>; <span class="ID">i</span> &lt; <span class="ID">n</span>; <span class="ID">i</span>++) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_15">  15</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_15"></span><span class="anchor" id="line-15-8"></span>        <span class="Comment">/* the -1 is needed to that a[0] goes to a[n-1] etc. */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_16">  16</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_16"></span><span class="anchor" id="line-16-8"></span>        <span class="ID">copy</span>[<span class="ID">n</span>-<span class="ID">i</span>-<span class="Number">1</span>] = <span class="ID">a</span>[<span class="ID">i</span>];</span>
<span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_17">  17</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_17"></span><span class="anchor" id="line-17-5"></span>    }</span>
<span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_18">  18</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_18"></span><span class="anchor" id="line-18-5"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_19">  19</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_19"></span><span class="anchor" id="line-19-5"></span>    <span class="ResWord">for</span>(<span class="ID">i</span> = <span class="Number">0</span>; <span class="ID">i</span> &lt; <span class="ID">n</span>; <span class="ID">i</span>++) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_20">  20</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_20"></span><span class="anchor" id="line-20-4"></span>        <span class="ID">a</span>[<span class="ID">i</span>] = <span class="ID">copy</span>[<span class="ID">i</span>];</span>
<span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_21">  21</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_21"></span><span class="anchor" id="line-21-4"></span>    }</span>
<span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_22">  22</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_22"></span><span class="anchor" id="line-22-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_23">  23</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_23"></span><span class="anchor" id="line-23-2"></span>    <span class="ID">free</span>(<span class="ID">copy</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_24">  24</a> </span><span class="LineAnchor" id="CA-388ceabbaedaf2f3285d5090e2e4c28692204ebe_24"></span><span class="anchor" id="line-24-2"></span>}</span>
</pre></div></div><span class="anchor" id="line-408"></span><span class="anchor" id="line-409"></span><p class="line867">
</p><h1 id="Void_pointers">6. Void pointers</h1>
<span class="anchor" id="line-410"></span><span class="anchor" id="line-411"></span><p class="line862">A special pointer type is <tt class="backtick">void&nbsp;*</tt>, a "pointer to <tt class="backtick">void</tt>".  Such pointers are declared in the usual way: <span class="anchor" id="line-412"></span><span class="anchor" id="line-413"></span></p><p class="line867"><span class="anchor" id="line-414"></span><span class="anchor" id="line-415"></span><span class="anchor" id="line-1-49"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-54763d7e2158744c1284a58248fe3f89771a2115\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-54763d7e2158744c1284a58248fe3f89771a2115', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-54763d7e2158744c1284a58248fe3f89771a2115" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-54763d7e2158744c1284a58248fe3f89771a2115_1">   1</a> </span><span class="LineAnchor" id="CA-54763d7e2158744c1284a58248fe3f89771a2115_1"></span><span class="anchor" id="line-1-50"></span>    <span class="ResWord">void</span> *<span class="ID">nothing</span>;      <span class="Comment">/* pointer to nothing */</span></span>
</pre></div></div><span class="anchor" id="line-416"></span><span class="anchor" id="line-417"></span><p class="line862">Unlike ordinary pointers, you can't derefence a <tt class="backtick">void&nbsp;*</tt> pointer or do arithmetic on it, because the compiler doesn't know what type it points to.  However, you are allowed to use a <tt class="backtick">void&nbsp;*</tt> as a kind of "raw address" pointer value that you can store arbitrary pointers in.  It is permitted to assign to a <tt class="backtick">void&nbsp;*</tt> variable from an expression of any pointer type; conversely, a <tt class="backtick">void&nbsp;*</tt> pointer value can be assigned to a pointer variable of any type. <span class="anchor" id="line-418"></span><span class="anchor" id="line-419"></span></p><p class="line862">If you need to use a <tt class="backtick">void&nbsp;*</tt> pointer as a pointer of a particular type in an expression, you can <strong>cast</strong> it to the appropriate type by prefixing it with a type name in parentheses, like this: <span class="anchor" id="line-420"></span><span class="anchor" id="line-421"></span></p><p class="line867"><span class="anchor" id="line-422"></span><span class="anchor" id="line-423"></span><span class="anchor" id="line-424"></span><span class="anchor" id="line-425"></span><span class="anchor" id="line-426"></span><span class="anchor" id="line-427"></span><span class="anchor" id="line-428"></span><span class="anchor" id="line-429"></span><span class="anchor" id="line-1-51"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-12fe0ae4cef89d723cd6d932329ff8181dd8997a\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-12fe0ae4cef89d723cd6d932329ff8181dd8997a', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-12fe0ae4cef89d723cd6d932329ff8181dd8997a" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-12fe0ae4cef89d723cd6d932329ff8181dd8997a_1">   1</a> </span><span class="LineAnchor" id="CA-12fe0ae4cef89d723cd6d932329ff8181dd8997a_1"></span><span class="anchor" id="line-1-52"></span>    <span class="ResWord">int</span> <span class="ID">a</span>[<span class="Number">50</span>];          <span class="Comment">/* typical array of ints */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-12fe0ae4cef89d723cd6d932329ff8181dd8997a_2">   2</a> </span><span class="LineAnchor" id="CA-12fe0ae4cef89d723cd6d932329ff8181dd8997a_2"></span><span class="anchor" id="line-2-24"></span>    <span class="ResWord">void</span> *<span class="ID">p</span>;            <span class="Comment">/* dangerous void pointer */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-12fe0ae4cef89d723cd6d932329ff8181dd8997a_3">   3</a> </span><span class="LineAnchor" id="CA-12fe0ae4cef89d723cd6d932329ff8181dd8997a_3"></span><span class="anchor" id="line-3-22"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-12fe0ae4cef89d723cd6d932329ff8181dd8997a_4">   4</a> </span><span class="LineAnchor" id="CA-12fe0ae4cef89d723cd6d932329ff8181dd8997a_4"></span><span class="anchor" id="line-4-21"></span>    <span class="ID">a</span>[<span class="Number">12</span>] = <span class="Number">17</span>;         <span class="Comment">/* save that valuable 17 */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-12fe0ae4cef89d723cd6d932329ff8181dd8997a_5">   5</a> </span><span class="LineAnchor" id="CA-12fe0ae4cef89d723cd6d932329ff8181dd8997a_5"></span><span class="anchor" id="line-5-19"></span>    <span class="ID">p</span> = <span class="ID">a</span>;              <span class="Comment">/* p now holds base address of a */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-12fe0ae4cef89d723cd6d932329ff8181dd8997a_6">   6</a> </span><span class="LineAnchor" id="CA-12fe0ae4cef89d723cd6d932329ff8181dd8997a_6"></span><span class="anchor" id="line-6-18"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-12fe0ae4cef89d723cd6d932329ff8181dd8997a_7">   7</a> </span><span class="LineAnchor" id="CA-12fe0ae4cef89d723cd6d932329ff8181dd8997a_7"></span><span class="anchor" id="line-7-14"></span>    <span class="ID">printf</span>(<span class="String">"</span><span class="String">%d</span><span class="SPChar">\n</span><span class="String">"</span>, ((<span class="ResWord">int</span> *) <span class="ID">p</span>)[<span class="Number">12</span>]);  <span class="Comment">/* get 17 back */</span></span>
</pre></div></div><span class="anchor" id="line-430"></span><span class="anchor" id="line-431"></span><p class="line862">Usually if you have to start writing casts, it's a sign that you are doing something wrong, and you run the danger of <strong>violating the type system</strong>---say, by tricking the compiler into treating a block of bits that are supposed to be an <tt class="backtick">int</tt> as four <tt class="backtick">char</tt>s.
  But violating the type system like this will be necessary for some 
applications, because even the weak type system in C turns out to be too
 restrictive for writing certain kinds of "generic" code that work on 
values of arbitrary types. <span class="anchor" id="line-432"></span><span class="anchor" id="line-433"></span></p><p class="line867">
</p><h1 id="Run-time_storage_allocation">7. Run-time storage allocation</h1>
<span class="anchor" id="line-434"></span><span class="anchor" id="line-435"></span><p class="line862">C
 does not permit arrays to be declared with variable sizes.  C also 
doesn't let local variables outlive the function they are declared in.  
Both features can be awkward if you want to build data structures at run
 time that have unpredictable (perhaps even changing) sizes and that are
 intended to persist longer than the functions that create them.  To 
build such structures, the standard C library provides the <tt class="backtick">malloc</tt>
 routine, which asks the operating system for a block of space of a 
given size (in bytes).  With a bit of pushing and shoving, this can be 
used to obtain a block of space that for all practical purposes acts 
just like an array. <span class="anchor" id="line-436"></span><span class="anchor" id="line-437"></span></p><p class="line862">To use <tt class="backtick">malloc</tt>, you must include <tt class="backtick">stdlib.h</tt> at the top of your program.  The declaration for <tt class="backtick">malloc</tt> is <span class="anchor" id="line-438"></span><span class="anchor" id="line-439"></span></p><p class="line867"><span class="anchor" id="line-440"></span><span class="anchor" id="line-441"></span><span class="anchor" id="line-1-53"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-7c2783ede67e364df1e11dcc8accfa36e3f9329d\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-7c2783ede67e364df1e11dcc8accfa36e3f9329d', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-7c2783ede67e364df1e11dcc8accfa36e3f9329d" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-7c2783ede67e364df1e11dcc8accfa36e3f9329d_1">   1</a> </span><span class="LineAnchor" id="CA-7c2783ede67e364df1e11dcc8accfa36e3f9329d_1"></span><span class="anchor" id="line-1-54"></span><span class="ResWord">void</span> *<span class="ID">malloc</span>(<span class="ID">size_t</span>);</span>
</pre></div></div><span class="anchor" id="line-442"></span><span class="anchor" id="line-443"></span><p class="line862">where <tt class="backtick">size_t</tt> is an integer type (often <tt class="backtick">unsigned&nbsp;long</tt>).  Calling <tt class="backtick">malloc</tt> with an argument of <tt class="backtick">n</tt> allocates and returns a pointer to the start of a block of <tt class="backtick">n</tt> bytes if possible.  If the system can't give you the space you asked for (maybe you asked for more space than it has), <tt class="backtick">malloc</tt> returns a null pointer.  It is good practice to test the return value of <tt class="backtick">malloc</tt> whenever you call it. <span class="anchor" id="line-444"></span><span class="anchor" id="line-445"></span></p><p class="line862">Because the return type of <tt class="backtick">malloc</tt> is <tt class="backtick">void&nbsp;*</tt>,
 its return value can be assigned to any variable with a pointer type.  
Computing the size of the block you need is your responsibility---and 
you will be punished for any mistakes with difficult-to-diagnose buffer 
overrun errors---but this task is made slightly easier by the built-in <tt class="backtick">sizeof</tt> operator that allows you to compute the size in bytes of any particular data type.  A typical call to <tt class="backtick">malloc</tt> might thus look something like this: <span class="anchor" id="line-446"></span><span class="anchor" id="line-447"></span></p><p class="line867"><span class="anchor" id="line-448"></span><span class="anchor" id="line-449"></span><span class="anchor" id="line-450"></span><span class="anchor" id="line-451"></span><span class="anchor" id="line-452"></span><span class="anchor" id="line-453"></span><span class="anchor" id="line-454"></span><span class="anchor" id="line-455"></span><span class="anchor" id="line-456"></span><span class="anchor" id="line-457"></span><span class="anchor" id="line-458"></span><span class="anchor" id="line-459"></span><span class="anchor" id="line-460"></span><span class="anchor" id="line-461"></span><span class="anchor" id="line-462"></span><span class="anchor" id="line-463"></span><span class="anchor" id="line-1-55"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_1">   1</a> </span><span class="LineAnchor" id="CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_1"></span><span class="anchor" id="line-1-56"></span><span class="Preprc">#</span><span class="Preprc">include &lt;stdlib.h&gt;</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_2">   2</a> </span><span class="LineAnchor" id="CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_2"></span><span class="anchor" id="line-2-25"></span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_3">   3</a> </span><span class="LineAnchor" id="CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_3"></span><span class="anchor" id="line-3-23"></span><span class="Comment">/* allocate and return a new integer array with n elements */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_4">   4</a> </span><span class="LineAnchor" id="CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_4"></span><span class="anchor" id="line-4-22"></span><span class="Comment">/* calls abort() if there isn't enough space */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_5">   5</a> </span><span class="LineAnchor" id="CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_5"></span><span class="anchor" id="line-5-20"></span><span class="ResWord">int</span> *</span>
<span class="line"><span class="LineNumber"><a href="#CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_6">   6</a> </span><span class="LineAnchor" id="CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_6"></span><span class="anchor" id="line-6-19"></span><span class="ID">makeIntArray</span>(<span class="ResWord">int</span> <span class="ID">n</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_7">   7</a> </span><span class="LineAnchor" id="CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_7"></span><span class="anchor" id="line-7-15"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_8">   8</a> </span><span class="LineAnchor" id="CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_8"></span><span class="anchor" id="line-8-13"></span>    <span class="ResWord">int</span> *<span class="ID">a</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_9">   9</a> </span><span class="LineAnchor" id="CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_9"></span><span class="anchor" id="line-9-13"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_10">  10</a> </span><span class="LineAnchor" id="CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_10"></span><span class="anchor" id="line-10-13"></span>    <span class="ID">a</span> = <span class="ID">malloc</span>(<span class="ResWord">sizeof</span>(<span class="ResWord">int</span>) * <span class="ID">n</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_11">  11</a> </span><span class="LineAnchor" id="CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_11"></span><span class="anchor" id="line-11-13"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_12">  12</a> </span><span class="LineAnchor" id="CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_12"></span><span class="anchor" id="line-12-11"></span>    <span class="ResWord">if</span>(<span class="ID">a</span> == <span class="Number">0</span>) <span class="ID">abort</span>();                 <span class="Comment">/* die on failure */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_13">  13</a> </span><span class="LineAnchor" id="CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_13"></span><span class="anchor" id="line-13-11"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_14">  14</a> </span><span class="LineAnchor" id="CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_14"></span><span class="anchor" id="line-14-11"></span>    <span class="ResWord">return</span> <span class="ID">a</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_15">  15</a> </span><span class="LineAnchor" id="CA-567fa72cced720ba7ab122d90e5f8e77519f1b6f_15"></span><span class="anchor" id="line-15-9"></span>}</span>
</pre></div></div><span class="anchor" id="line-464"></span><span class="anchor" id="line-465"></span><p class="line862">When you are done with a <tt class="backtick">malloc</tt>'d region, you should return the space to the system using the <tt class="backtick">free</tt> routine, also defined in <tt class="backtick">stdlib.h</tt>.  If you don't do this, your program will quickly run out of space.  The <tt class="backtick">free</tt> routine takes a <tt class="backtick">void&nbsp;*</tt> as its argument and returns nothing.  It is good practice to write a matching <strong>destructor</strong> that de-allocates an object for each <strong>constructor</strong> (like <tt class="backtick">makeIntArray</tt>) that makes one. <span class="anchor" id="line-466"></span><span class="anchor" id="line-467"></span></p><p class="line867"><span class="anchor" id="line-468"></span><span class="anchor" id="line-469"></span><span class="anchor" id="line-470"></span><span class="anchor" id="line-471"></span><span class="anchor" id="line-472"></span><span class="anchor" id="line-473"></span><span class="anchor" id="line-1-57"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-56b5ade15865270622c1a1e1fb5ef4f04388677a\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-56b5ade15865270622c1a1e1fb5ef4f04388677a', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-56b5ade15865270622c1a1e1fb5ef4f04388677a" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-56b5ade15865270622c1a1e1fb5ef4f04388677a_1">   1</a> </span><span class="LineAnchor" id="CA-56b5ade15865270622c1a1e1fb5ef4f04388677a_1"></span><span class="anchor" id="line-1-58"></span><span class="ResWord">void</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-56b5ade15865270622c1a1e1fb5ef4f04388677a_2">   2</a> </span><span class="LineAnchor" id="CA-56b5ade15865270622c1a1e1fb5ef4f04388677a_2"></span><span class="anchor" id="line-2-26"></span><span class="ID">destroyIntArray</span>(<span class="ResWord">int</span> *<span class="ID">a</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-56b5ade15865270622c1a1e1fb5ef4f04388677a_3">   3</a> </span><span class="LineAnchor" id="CA-56b5ade15865270622c1a1e1fb5ef4f04388677a_3"></span><span class="anchor" id="line-3-24"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-56b5ade15865270622c1a1e1fb5ef4f04388677a_4">   4</a> </span><span class="LineAnchor" id="CA-56b5ade15865270622c1a1e1fb5ef4f04388677a_4"></span><span class="anchor" id="line-4-23"></span>    <span class="ID">free</span>(<span class="ID">a</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-56b5ade15865270622c1a1e1fb5ef4f04388677a_5">   5</a> </span><span class="LineAnchor" id="CA-56b5ade15865270622c1a1e1fb5ef4f04388677a_5"></span><span class="anchor" id="line-5-21"></span>}</span>
</pre></div></div><span class="anchor" id="line-474"></span><span class="anchor" id="line-475"></span><p class="line862">It is a serious error to do anything at all with a block after it has been <tt class="backtick">free</tt>d. <span class="anchor" id="line-476"></span><span class="anchor" id="line-477"></span></p><p class="line862">It is also possible to grow or shrink a previously allocated block.  This is done using the <tt class="backtick">realloc</tt> function, which is declared as <span class="anchor" id="line-478"></span><span class="anchor" id="line-479"></span></p><p class="line867"><span class="anchor" id="line-480"></span><span class="anchor" id="line-481"></span><span class="anchor" id="line-1-59"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-e9ca54ad23218f4e49c4cbeaf9408fce35ea899e\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-e9ca54ad23218f4e49c4cbeaf9408fce35ea899e', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-e9ca54ad23218f4e49c4cbeaf9408fce35ea899e" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-e9ca54ad23218f4e49c4cbeaf9408fce35ea899e_1">   1</a> </span><span class="LineAnchor" id="CA-e9ca54ad23218f4e49c4cbeaf9408fce35ea899e_1"></span><span class="anchor" id="line-1-60"></span><span class="ResWord">void</span> *<span class="ID">realloc</span>(<span class="ResWord">void</span> *<span class="ID">oldBlock</span>, <span class="ID">size_t</span> <span class="ID">newSize</span>);</span>
</pre></div></div><span class="anchor" id="line-482"></span><span class="anchor" id="line-483"></span><p class="line862">The <tt class="backtick">realloc</tt>
 function returns a pointer to the resized block.  It may or may not 
allocate a new block; if there is room, it may leave the old block in 
place and return its argument.  But it may allocate a new block and copy
 the contents of the old block, so you should assume that the old 
pointer has been <tt class="backtick">free</tt>d. <span class="anchor" id="line-484"></span><span class="anchor" id="line-485"></span></p><p class="line862">Here's a typical use of <tt class="backtick">realloc</tt> to build an array that grows as large as it needs to be: <span class="anchor" id="line-486"></span><span class="anchor" id="line-487"></span></p><p class="line867"><span class="anchor" id="line-488"></span><span class="anchor" id="line-489"></span><span class="anchor" id="line-490"></span><span class="anchor" id="line-491"></span><span class="anchor" id="line-492"></span><span class="anchor" id="line-493"></span><span class="anchor" id="line-494"></span><span class="anchor" id="line-495"></span><span class="anchor" id="line-496"></span><span class="anchor" id="line-497"></span><span class="anchor" id="line-498"></span><span class="anchor" id="line-499"></span><span class="anchor" id="line-500"></span><span class="anchor" id="line-501"></span><span class="anchor" id="line-502"></span><span class="anchor" id="line-503"></span><span class="anchor" id="line-504"></span><span class="anchor" id="line-505"></span><span class="anchor" id="line-506"></span><span class="anchor" id="line-507"></span><span class="anchor" id="line-508"></span><span class="anchor" id="line-509"></span><span class="anchor" id="line-510"></span><span class="anchor" id="line-511"></span><span class="anchor" id="line-512"></span><span class="anchor" id="line-513"></span><span class="anchor" id="line-514"></span><span class="anchor" id="line-515"></span><span class="anchor" id="line-516"></span><span class="anchor" id="line-517"></span><span class="anchor" id="line-518"></span><span class="anchor" id="line-519"></span><span class="anchor" id="line-520"></span><span class="anchor" id="line-521"></span><span class="anchor" id="line-522"></span><span class="anchor" id="line-523"></span><span class="anchor" id="line-524"></span><span class="anchor" id="line-525"></span><span class="anchor" id="line-526"></span><span class="anchor" id="line-527"></span><span class="anchor" id="line-1-61"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-601c8e5d35454dccee419463bff06fa3e01dccac\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-601c8e5d35454dccee419463bff06fa3e01dccac', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_1">   1</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_1"></span><span class="anchor" id="line-1-62"></span><span class="Comment">/* read numbers from stdin until there aren't any more */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_2">   2</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_2"></span><span class="anchor" id="line-2-27"></span><span class="Comment">/* returns an array of all numbers read, or null on error */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_3">   3</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_3"></span><span class="anchor" id="line-3-25"></span><span class="Comment">/* returns the count of numbers read in *count */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_4">   4</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_4"></span><span class="anchor" id="line-4-24"></span><span class="ResWord">int</span> *</span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_5">   5</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_5"></span><span class="anchor" id="line-5-22"></span><span class="ID">readNumbers</span>(<span class="ResWord">int</span> *<span class="ID">count</span> <span class="Comment">/* RETVAL */</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_6">   6</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_6"></span><span class="anchor" id="line-6-20"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_7">   7</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_7"></span><span class="anchor" id="line-7-16"></span>    <span class="ResWord">int</span> <span class="ID">mycount</span>;        <span class="Comment">/* number of numbers read */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_8">   8</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_8"></span><span class="anchor" id="line-8-14"></span>    <span class="ResWord">int</span> <span class="ID">size</span>;           <span class="Comment">/* size of block allocated so far */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_9">   9</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_9"></span><span class="anchor" id="line-9-14"></span>    <span class="ResWord">int</span> *<span class="ID">a</span>;             <span class="Comment">/* block */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_10">  10</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_10"></span><span class="anchor" id="line-10-14"></span>    <span class="ResWord">int</span> <span class="ID">n</span>;              <span class="Comment">/* number read */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_11">  11</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_11"></span><span class="anchor" id="line-11-14"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_12">  12</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_12"></span><span class="anchor" id="line-12-12"></span>    <span class="ID">mycount</span> = <span class="Number">0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_13">  13</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_13"></span><span class="anchor" id="line-13-12"></span>    <span class="ID">size</span> = <span class="Number">1</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_14">  14</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_14"></span><span class="anchor" id="line-14-12"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_15">  15</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_15"></span><span class="anchor" id="line-15-10"></span>    <span class="ID">a</span> = <span class="ID">malloc</span>(<span class="ResWord">sizeof</span>(<span class="ResWord">int</span>) * <span class="ID">size</span>);     <span class="Comment">/* allocating zero bytes is tricky */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_16">  16</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_16"></span><span class="anchor" id="line-16-9"></span>    <span class="ResWord">if</span>(<span class="ID">a</span> == <span class="Number">0</span>) <span class="ResWord">return</span> <span class="Number">0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_17">  17</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_17"></span><span class="anchor" id="line-17-6"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_18">  18</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_18"></span><span class="anchor" id="line-18-6"></span>    <span class="ResWord">while</span>(<span class="ID">scanf</span>(<span class="String">"</span><span class="String">%d</span><span class="String">"</span>, &amp;<span class="ID">n</span>) == <span class="Number">1</span>) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_19">  19</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_19"></span><span class="anchor" id="line-19-6"></span>        <span class="Comment">/* is there room? */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_20">  20</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_20"></span><span class="anchor" id="line-20-5"></span>        <span class="ResWord">while</span>(<span class="ID">mycount</span> &gt;= <span class="ID">size</span>) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_21">  21</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_21"></span><span class="anchor" id="line-21-5"></span>            <span class="Comment">/* double the size to avoid calling realloc for every number read */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_22">  22</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_22"></span><span class="anchor" id="line-22-5"></span>            <span class="ID">size</span> *= <span class="Number">2</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_23">  23</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_23"></span><span class="anchor" id="line-23-3"></span>            <span class="ID">a</span> = <span class="ID">realloc</span>(<span class="ID">a</span>, <span class="ResWord">sizeof</span>(<span class="ResWord">int</span>) * <span class="ID">size</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_24">  24</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_24"></span><span class="anchor" id="line-24-3"></span>            <span class="ResWord">if</span>(<span class="ID">a</span> == <span class="Number">0</span>) <span class="ResWord">return</span> <span class="Number">0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_25">  25</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_25"></span><span class="anchor" id="line-25-2"></span>        }</span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_26">  26</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_26"></span><span class="anchor" id="line-26-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_27">  27</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_27"></span><span class="anchor" id="line-27-1"></span>        <span class="Comment">/* put the new number in */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_28">  28</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_28"></span><span class="anchor" id="line-28-1"></span>        <span class="ID">a</span>[<span class="ID">mycount</span>++] = <span class="ID">n</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_29">  29</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_29"></span><span class="anchor" id="line-29-1"></span>    }</span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_30">  30</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_30"></span><span class="anchor" id="line-30-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_31">  31</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_31"></span><span class="anchor" id="line-31-1"></span>    <span class="Comment">/* now trim off any excess space */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_32">  32</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_32"></span><span class="anchor" id="line-32-1"></span>    <span class="ID">a</span> = <span class="ID">realloc</span>(<span class="ID">a</span>, <span class="ResWord">sizeof</span>(<span class="ResWord">int</span>) * <span class="ID">mycount</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_33">  33</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_33"></span><span class="anchor" id="line-33-1"></span>    <span class="Comment">/* note: if a == 0 at this point we'll just return it anyway */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_34">  34</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_34"></span><span class="anchor" id="line-34-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_35">  35</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_35"></span><span class="anchor" id="line-35-1"></span>    <span class="Comment">/* save out mycount */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_36">  36</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_36"></span><span class="anchor" id="line-36-1"></span>    *<span class="ID">count</span> = <span class="ID">mycount</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_37">  37</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_37"></span><span class="anchor" id="line-37-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_38">  38</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_38"></span><span class="anchor" id="line-38-1"></span>    <span class="ResWord">return</span> <span class="ID">a</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-601c8e5d35454dccee419463bff06fa3e01dccac_39">  39</a> </span><span class="LineAnchor" id="CA-601c8e5d35454dccee419463bff06fa3e01dccac_39"></span><span class="anchor" id="line-39-1"></span>}</span>
</pre></div></div><span class="anchor" id="line-528"></span><span class="anchor" id="line-529"></span><p class="line862">Because errors involving <tt class="backtick">malloc</tt> and its friends can be very difficult to spot, it is recommended to test any program that uses <tt class="backtick">malloc</tt> using <tt class="backtick">valgrind</tt> if possible.  (See <a href="http://www.cs.yale.edu/homes/aspnes/pinewiki/C%282f%29valgrind.html">C/valgrind</a>). <span class="anchor" id="line-530"></span><span class="anchor" id="line-531"></span></p><p class="line862">(See also <a href="http://www.cs.yale.edu/homes/aspnes/pinewiki/C%282f%29DynamicStorageAllocation.html">C/DynamicStorageAllocation</a> for some old notes on this subject.) <span class="anchor" id="line-532"></span><span class="anchor" id="line-533"></span></p><p class="line867">
</p><h1 id="The_restrict_keyword">8. The restrict keyword</h1>
<span class="anchor" id="line-534"></span><span class="anchor" id="line-535"></span><p class="line862">In
 C99, it is possible to declare that a pointer variable is the only way 
to reach its target as long as it is in scope.  This is not enforced by 
the compiler; instead, it is a promise from the programmer <em>to</em> 
the compiler that any data reached through this point will not be 
changed by other parts of the code, which allows the compiler to 
optimize code in ways that are not possible if pointers might point to 
the same place (a phenomenon called <strong>pointer aliasing</strong>).  For example, in the short routine: <span class="anchor" id="line-536"></span><span class="anchor" id="line-537"></span><span class="anchor" id="line-538"></span><span class="anchor" id="line-539"></span><span class="anchor" id="line-540"></span><span class="anchor" id="line-541"></span><span class="anchor" id="line-542"></span><span class="anchor" id="line-543"></span><span class="anchor" id="line-544"></span><span class="anchor" id="line-1-63"></span></p><div class="highlight c"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-7ffe2352809b634a1dae411958c179db1eb54255\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-7ffe2352809b634a1dae411958c179db1eb54255', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-7ffe2352809b634a1dae411958c179db1eb54255" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-7ffe2352809b634a1dae411958c179db1eb54255_1">   1</a> </span><span class="LineAnchor" id="CA-7ffe2352809b634a1dae411958c179db1eb54255_1"></span><span class="anchor" id="line-1-64"></span><span class="Comment">// write 1 + *src to *dst and return *src</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-7ffe2352809b634a1dae411958c179db1eb54255_2">   2</a> </span><span class="LineAnchor" id="CA-7ffe2352809b634a1dae411958c179db1eb54255_2"></span><span class="anchor" id="line-2-28"></span><span class="Comment"></span><span class="ResWord">int</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-7ffe2352809b634a1dae411958c179db1eb54255_3">   3</a> </span><span class="LineAnchor" id="CA-7ffe2352809b634a1dae411958c179db1eb54255_3"></span><span class="anchor" id="line-3-26"></span><span class="ID">copyPlusOne</span>(<span class="ResWord">int</span> * <span class="ResWord">restrict</span> <span class="ID">dst</span>, <span class="ResWord">int</span> * <span class="ResWord">restrict</span> <span class="ID">src</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-7ffe2352809b634a1dae411958c179db1eb54255_4">   4</a> </span><span class="LineAnchor" id="CA-7ffe2352809b634a1dae411958c179db1eb54255_4"></span><span class="anchor" id="line-4-25"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-7ffe2352809b634a1dae411958c179db1eb54255_5">   5</a> </span><span class="LineAnchor" id="CA-7ffe2352809b634a1dae411958c179db1eb54255_5"></span><span class="anchor" id="line-5-23"></span>    *<span class="ID">dst</span> = *<span class="ID">src</span> + <span class="Number">1</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-7ffe2352809b634a1dae411958c179db1eb54255_6">   6</a> </span><span class="LineAnchor" id="CA-7ffe2352809b634a1dae411958c179db1eb54255_6"></span><span class="anchor" id="line-6-21"></span>    <span class="ResWord">return</span> *<span class="ID">src</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-7ffe2352809b634a1dae411958c179db1eb54255_7">   7</a> </span><span class="LineAnchor" id="CA-7ffe2352809b634a1dae411958c179db1eb54255_7"></span><span class="anchor" id="line-7-17"></span>}</span>
</pre></div></div><span class="anchor" id="line-545"></span><p class="line862">the output of <tt class="backtick">gcc&nbsp;-std=c99&nbsp;-O3&nbsp;-S</tt> includes one more instruction if the <tt class="backtick">restrict</tt> qualifiers are removed.  The reason is that if <tt class="backtick">dst</tt> and <tt class="backtick">src</tt> may point to the same location, <tt class="backtick">src</tt> needs to be re-read for the <tt class="backtick">return</tt>
 statement, in case it changed, but if they don't, the compiler can 
re-use the previous value it already has in one of the CPU registers. <span class="anchor" id="line-546"></span><span class="anchor" id="line-547"></span></p><p class="line862">For
 most code, this feature is useless, and potentially dangerous if 
someone calls your routine with aliased pointers.  However, it may 
sometimes be possible to increase performance of time-critical code by 
adding a <tt class="backtick">restrict</tt> keyword.  The cost is that the code might no longer work if called with aliased pointers. <span class="anchor" id="line-548"></span><span class="anchor" id="line-549"></span></p><p class="line867"></p><hr><p class="line874"> <span class="anchor" id="line-550"></span><a href="http://www.cs.yale.edu/homes/aspnes/pinewiki/CategoryProgrammingNotes.html">CategoryProgrammingNotes</a> <span class="anchor" id="line-551"></span><span class="anchor" id="bottom"></span></p></div>
</div>
<hr>
2014-06-17 11:57


</body></html>